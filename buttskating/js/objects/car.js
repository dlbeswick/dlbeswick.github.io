import { assert } from "../assert.js";
import { GameObject } from "../gameobject.js";
import { Point } from "../point2.js";
import { g_App } from "../app.js";
import { Particle, PARTICLE_TYPE } from "./particle.js";
import { Player } from "./player.js";
var CAR_STATE;
(function (CAR_STATE) {
    CAR_STATE[CAR_STATE["PARKED"] = 0] = "PARKED";
    CAR_STATE[CAR_STATE["ACCELERATING"] = 1] = "ACCELERATING";
    CAR_STATE[CAR_STATE["STOPPING"] = 2] = "STOPPING";
    CAR_STATE[CAR_STATE["STOPPED"] = 3] = "STOPPED";
})(CAR_STATE || (CAR_STATE = {}));
;
export class Car extends GameObject {
    constructor(x, y, dir) {
        super();
        // Positions
        this.m_smokePos = Point(0, 0);
        this.m_smokeDir = Point(0, 0);
        this.m_smokeMag = Point(0, 0);
        this.m_bboxTL = Point(0, 0);
        this.m_bboxBR = Point(0, 0);
        this.m_pos = Point(x, y);
        this.m_dir = dir;
        this.m_frame = 33;
        this.m_state = CAR_STATE.PARKED;
        this.m_smoke = g_App.irand(0, 4);
        this.m_idle = g_App.irand(0, 7);
        assert(GameObject.m_pictures);
        switch (this.m_dir) {
            case 0:
                this.m_vel = Point(0, -1);
                this.m_bboxTL.x = -GameObject.m_pictures.getFrame(this.m_frame).width * 0.5;
                this.m_bboxTL.y = 0;
                this.m_bboxBR.x = GameObject.m_pictures.getFrame(this.m_frame).width * 0.5;
                this.m_bboxBR.y = 480;
                break;
            case 1:
                this.m_vel = Point(1, 0);
                this.m_bboxTL.x = -480;
                this.m_bboxTL.y = -GameObject.m_pictures.getFrame(this.m_frame).height * 0.5;
                this.m_bboxBR.x = 0;
                this.m_bboxBR.y = GameObject.m_pictures.getFrame(this.m_frame).height * 0.5;
                break;
            case 2:
                this.m_vel = Point(0, 1);
                this.m_bboxTL.x = -GameObject.m_pictures.getFrame(this.m_frame).width * 0.5;
                this.m_bboxTL.y = -480;
                this.m_bboxBR.x = GameObject.m_pictures.getFrame(this.m_frame).width * 0.5;
                this.m_bboxBR.y = 0;
                break;
            case 3:
                this.m_vel = Point(-1, 0);
                this.m_bboxTL.x = 0;
                this.m_bboxTL.y = -GameObject.m_pictures.getFrame(this.m_frame).height * 0.5;
                this.m_bboxBR.x = 480;
                this.m_bboxBR.y = GameObject.m_pictures.getFrame(this.m_frame).height * 0.5;
                break;
            default:
                throw ("Invalid direction for car");
        }
        this.m_smokePos.x = -15;
        this.m_smokePos.y = -GameObject.m_pictures.getFrame(this.m_frame).height * 0.5;
        this.m_smokePos = this.m_smokePos.vecRotated(this.m_vel);
        this.m_smokePos.x *= -1;
        this.m_smokeDir.x = -0.5;
        this.m_smokeDir.y = -0.5;
        this.m_smokeMag.x = 1;
        this.m_smokeMag.y = -4;
        this.m_smokeDir = this.m_smokeDir.vecRotated(this.m_vel);
        this.m_smokeMag = this.m_smokeMag.vecRotated(this.m_vel);
        this.m_smokeDir.x *= -1;
        this.m_smokeMag.x *= -1;
        // Car moves opposite to direction it's facing
        this.m_vel.sMulEq(-1);
    }
    draw(ctx) {
        this.m_idle++;
        const offset = Car.m_idleOffsets[this.m_idle % 7];
        ctx.translate(offset.x, offset.y);
        super.draw(ctx);
    }
    gameUpdate() {
        this.m_smoke++;
        if (this.m_smoke % 4 == 0) {
            const vel = Point(g_App.frand(this.m_smokeDir.x, this.m_smokeMag.x), g_App.frand(this.m_smokeDir.y, this.m_smokeMag.y));
            g_App.add(new Particle(this.m_pos.x + this.m_smokePos.x, this.m_pos.y + this.m_smokePos.y, "PARTICLE_SMOKE", 1, PARTICLE_TYPE.STD, vel, 0));
        }
        if (this.m_state == CAR_STATE.PARKED) {
            // If we have detected a player, race out
            for (let i = 0; i < Player.getNumPlayers(); i++) {
                const pPlayer = Player.getPlayer(i);
                assert(pPlayer != undefined);
                if (g_App.pointBox(pPlayer.m_pos.x, pPlayer.m_pos.y, this.m_pos.x + this.m_bboxTL.x, this.m_pos.y + this.m_bboxTL.y, this.m_pos.x + this.m_bboxBR.x, this.m_pos.y + this.m_bboxBR.y)) {
                    this.m_state = CAR_STATE.ACCELERATING;
                }
            }
        }
        else if (this.m_state == CAR_STATE.ACCELERATING) {
            this.m_speed += 0.35;
            this.m_pos.plusEq(this.m_vel.sMul(this.m_speed));
            if (this.m_speed >= 8)
                this.m_state = CAR_STATE.STOPPING;
        }
        else if (this.m_state == CAR_STATE.STOPPING) {
            this.m_speed -= 0.25;
            this.m_pos.plusEq(this.m_vel.sMul(this.m_speed));
            if (this.m_speed <= 0)
                this.m_state = CAR_STATE.STOPPED;
        }
        return true;
    }
    get rotation() {
        return -this.m_vel.y > 0 ? Math.asin(this.m_vel.x) : -Math.PI - Math.asin(this.m_vel.x);
    }
}
Car.m_idleOffsets = [
    Point(0, 2),
    Point(1, 1),
    Point(1, 0),
    Point(2, 0),
    Point(2, 0),
    Point(0, 1),
    Point(0, 1)
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdHMvb2JqZWN0cy9jYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUNyQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxFQUFVLEtBQUssRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUM1QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBQ2pDLE9BQU8sRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBQ3ZELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxhQUFhLENBQUE7QUFFcEMsSUFBSyxTQU1KO0FBTkQsV0FBSyxTQUFTO0lBRWIsNkNBQU0sQ0FBQTtJQUNOLHlEQUFZLENBQUE7SUFDWixpREFBUSxDQUFBO0lBQ1IsK0NBQU8sQ0FBQTtBQUNSLENBQUMsRUFOSSxTQUFTLEtBQVQsU0FBUyxRQU1iO0FBQUEsQ0FBQztBQUVGLE1BQU0sT0FBTyxHQUFJLFNBQVEsVUFBVTtJQUNsQyxZQUFZLENBQVMsRUFBRSxDQUFTLEVBQUUsR0FBVztRQUMxQyxLQUFLLEVBQUUsQ0FBQTtRQXFFVixZQUFZO1FBQ1osZUFBVSxHQUFXLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDaEMsZUFBVSxHQUFXLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDaEMsZUFBVSxHQUFXLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDaEMsYUFBUSxHQUFXLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDOUIsYUFBUSxHQUFXLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUF4RTVCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMs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RSxDQUFDLENBQUM7Q0FDWCxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXNzZXJ0IH0gZnJvbSBcIi4uL2Fzc2VydC5qc1wiXG5pbXBvcnQgeyBHYW1lT2JqZWN0IH0gZnJvbSBcIi4uL2dhbWVvYmplY3QuanNcIlxuaW1wb3J0IHsgUG9pbnQyLCBQb2ludCB9IGZyb20gXCIuLi9wb2ludDIuanNcIlxuaW1wb3J0IHsgZ19BcHAgfSBmcm9tIFwiLi4vYXBwLmpzXCJcbmltcG9ydCB7IFBhcnRpY2xlLCBQQVJUSUNMRV9UWVBFIH0gZnJvbSBcIi4vcGFydGljbGUuanNcIlxuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vcGxheWVyLmpzXCJcblxuZW51bSBDQVJfU1RBVEVcbntcblx0UEFSS0VELFxuXHRBQ0NFTEVSQVRJTkcsXG5cdFNUT1BQSU5HLFxuXHRTVE9QUEVEXG59O1xuXG5leHBvcnQgY2xhc3MgQ2FyIGV4dGVuZHMgR2FtZU9iamVjdCB7XG5cdGNvbnN0cnVjdG9yKHg6IG51bWJlciwgeTogbnVtYmVyLCBkaXI6IG51bWJlcikge1xuICAgIHN1cGVyKClcbiAgICBcblx0ICB0aGlzLm1fcG9zID0gUG9pbnQoeCwgeSk7XG5cdCAgdGhpcy5tX2RpciA9IGRpcjtcblx0ICB0aGlzLm1fZnJhbWUgPSAzMztcblx0ICB0aGlzLm1fc3RhdGUgPSBDQVJfU1RBVEUuUEFSS0VEO1xuXHQgIHRoaXMubV9zbW9rZSA9IGdfQXBwIS5pcmFuZCgwLCA0KTtcblx0ICB0aGlzLm1faWRsZSA9IGdfQXBwIS5pcmFuZCgwLCA3KTtcblxuICAgIGFzc2VydChHYW1lT2JqZWN0Lm1fcGljdHVyZXMpXG4gICAgXG5cdCAgc3dpdGNoICh0aGlzLm1fZGlyKVxuXHQgIHtcblx0ICAgIGNhc2UgMDpcblx0XHQgICAgdGhpcy5tX3ZlbCA9IFBvaW50KDAsIC0xKTtcblx0XHQgICAgdGhpcy5tX2Jib3hUTC54ID0gLUdhbWVPYmplY3QubV9waWN0dXJlcy5nZXRGcmFtZSh0aGlzLm1fZnJhbWUpLndpZHRoICogMC41O1xuXHRcdCAgICB0aGlzLm1fYmJveFRMLnkgPSAwO1xuXHRcdCAgICB0aGlzLm1fYmJveEJSLnggPSBHYW1lT2JqZWN0Lm1fcGljdHVyZXMuZ2V0RnJhbWUodGhpcy5tX2ZyYW1lKS53aWR0aCAqIDAuNTtcblx0XHQgICAgdGhpcy5tX2Jib3hCUi55ID0gNDgwO1xuXHRcdCAgICBicmVhaztcblx0ICAgIGNhc2UgMTpcblx0XHQgICAgdGhpcy5tX3ZlbCA9IFBvaW50KDEsIDApO1xuXHRcdCAgICB0aGlzLm1fYmJveFRMLnggPSAtNDgwO1xuXHRcdCAgICB0aGlzLm1fYmJveFRMLnkgPSAtR2FtZU9iamVjdC5tX3BpY3R1cmVzLmdldEZyYW1lKHRoaXMubV9mcmFtZSkuaGVpZ2h0ICogMC41O1xuXHRcdCAgICB0aGlzLm1fYmJveEJSLnggPSAwO1xuXHRcdCAgICB0aGlzLm1fYmJveEJSLnkgPSBHYW1lT2JqZWN0Lm1fcGljdHVyZXMuZ2V0RnJhbWUodGhpcy5tX2ZyYW1lKS5oZWlnaHQgKiAwLjU7XG5cdFx0ICAgIGJyZWFrO1xuXHQgICAgY2FzZSAyOlxuXHRcdCAgICB0aGlzLm1fdmVsID0gUG9pbnQoMCwgMSk7XG5cdFx0ICAgIHRoaXMubV9iYm94VEwueCA9IC1HYW1lT2JqZWN0Lm1fcGljdHVyZXMuZ2V0RnJhbWUodGhpcy5tX2ZyYW1lKS53aWR0aCAqIDAuNTtcblx0XHQgICAgdGhpcy5tX2Jib3hUTC55ID0gLTQ4MDtcblx0XHQgICAgdGhpcy5tX2Jib3hCUi54ID0gR2FtZU9iamVjdC5tX3BpY3R1cmVzLmdldEZyYW1lKHRoaXMubV9mcmFtZSkud2lkdGggKiAwLjU7XG5cdFx0ICAgIHRoaXMubV9iYm94QlIueSA9IDA7XG5cdFx0ICAgIGJyZWFrO1xuXHQgICAgY2FzZSAzOlxuXHRcdCAgICB0aGlzLm1fdmVsID0gUG9pbnQoLTEsIDApO1xuXHRcdCAgICB0aGlzLm1fYmJveFRMLnggPSAwO1xuXHRcdCAgICB0aGlzLm1fYmJveFRMLnkgPSAtR2FtZU9iamVjdC5tX3BpY3R1cmVzLmdldEZyYW1lKHRoaXMubV9mcmFtZSkuaGVpZ2h0ICogMC41O1xuXHRcdCAgICB0aGlzLm1fYmJveEJSLnggPSA0ODA7XG5cdFx0ICAgIHRoaXMubV9iYm94QlIueSA9IEdhbWVPYmplY3QubV9waWN0dXJlcy5nZXRGcmFtZSh0aGlzLm1fZnJhbWUpLmhlaWdodCAqIDAuNTtcblx0XHQgICAgYnJlYWs7XG5cdCAgICBkZWZhdWx0OlxuXHRcdCAgICB0aHJvdyhcIkludmFsaWQgZGlyZWN0aW9uIGZvciBjYXJcIik7XG5cdCAgfVxuXG5cdCAgdGhpcy5tX3Ntb2tlUG9zLnggPSAtMTU7XG5cdCAgdGhpcy5tX3Ntb2tlUG9zLnkgPSAtR2FtZU9iamVjdC5tX3BpY3R1cmVzLmdldEZyYW1lKHRoaXMubV9mcmFtZSkuaGVpZ2h0ICogMC41O1xuXHQgIHRoaXMubV9zbW9rZVBvcyA9IHRoaXMubV9zbW9rZVBvcy52ZWNSb3RhdGVkKHRoaXMubV92ZWwpO1xuXHQgIHRoaXMubV9zbW9rZVBvcy54ICo9IC0xO1xuXG5cdCAgdGhpcy5tX3Ntb2tlRGlyLnggPSAtMC41O1xuXHQgIHRoaXMubV9zbW9rZURpci55ID0gLTAuNTtcblx0ICB0aGlzLm1fc21va2VNYWcueCA9IDE7XG5cdCAgdGhpcy5tX3Ntb2tlTWFnLnkgPSAtNDtcblx0ICB0aGlzLm1fc21va2VEaXIgPSB0aGlzLm1fc21va2VEaXIudmVjUm90YXRlZCh0aGlzLm1fdmVsKTtcblx0ICB0aGlzLm1fc21va2VNYWcgPSB0aGlzLm1fc21va2VNYWcudmVjUm90YXRlZCh0aGlzLm1fdmVsKTtcblx0ICB0aGlzLm1fc21va2VEaXIueCAqPSAtMTtcblx0ICB0aGlzLm1fc21va2VNYWcueCAqPSAtMTtcblxuXHQgIC8vIENhciBtb3ZlcyBvcHBvc2l0ZSB0byBkaXJlY3Rpb24gaXQncyBmYWNpbmdcblx0ICB0aGlzLm1fdmVsLnNNdWxFcSgtMSk7XG4gIH1cblxuXG5cdG1fZGlyOiBudW1iZXJcblx0bV9zdGF0ZTogQ0FSX1NUQVRFO1xuXHRtX3Ntb2tlOiBudW1iZXJcblx0bV9pZGxlOiBudW1iZXJcblxuXHQvLyBQb3NpdGlvbnNcblx0bV9zbW9rZVBvczogUG9pbnQyID0gUG9pbnQoMCwgMClcblx0bV9zbW9rZURpcjogUG9pbnQyID0gUG9pbnQoMCwgMClcblx0bV9zbW9rZU1hZzogUG9pbnQyID0gUG9pbnQoMCwgMClcblx0bV9iYm94VEw6IFBvaW50MiA9IFBvaW50KDAsIDApXG5cdG1fYmJveEJSOiBQb2ludDIgPSBQb2ludCgwLCAwKVxuXG5cdGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcblx0ICB0aGlzLm1faWRsZSsrO1xuXG5cdCAgY29uc3Qgb2Zmc2V0ID0gQ2FyLm1faWRsZU9mZnNldHNbdGhpcy5tX2lkbGUgJSA3XTtcblx0ICBjdHgudHJhbnNsYXRlKG9mZnNldC54LCBvZmZzZXQueSk7XG5cdCAgc3VwZXIuZHJhdyhjdHgpO1xuICB9XG5cblx0Z2FtZVVwZGF0ZSgpIHtcblx0ICB0aGlzLm1fc21va2UrKztcblx0ICBpZiAodGhpcy5tX3Ntb2tlICUgNCA9PSAwKVxuXHQgIHtcblx0XHQgIGNvbnN0IHZlbCA9IFBvaW50KGdfQXBwIS5mcmFuZCh0aGlzLm1fc21va2VEaXIueCwgdGhpcy5tX3Ntb2tlTWFnLngpLCBcblx0XHRcdFx0XHRcdFx0XHQgICAgICAgIGdfQXBwIS5mcmFuZCh0aGlzLm1fc21va2VEaXIueSwgdGhpcy5tX3Ntb2tlTWFnLnkpKTtcblxuXHRcdCAgZ19BcHAhLmFkZChuZXcgUGFydGljbGUodGhpcy5tX3Bvcy54ICsgdGhpcy5tX3Ntb2tlUG9zLngsXG5cdFx0XHRcdFx0ICAgICAgICAgICAgICAgICAgICB0aGlzLm1fcG9zLnkgKyB0aGlzLm1fc21va2VQb3MueSxcblx0XHRcdFx0XHQgICAgICAgICAgICAgICAgICAgIFwiUEFSVElDTEVfU01PS0VcIiwgMSwgUEFSVElDTEVfVFlQRS5TVEQsIHZlbCwgMCkpO1xuXHQgIH1cblxuXHQgIGlmICh0aGlzLm1fc3RhdGUgPT0gQ0FSX1NUQVRFLlBBUktFRClcblx0ICB7XG5cdFx0ICAvLyBJZiB3ZSBoYXZlIGRldGVjdGVkIGEgcGxheWVyLCByYWNlIG91dFxuXHRcdCAgZm9yIChsZXQgaT0wOyBpIDwgUGxheWVyLmdldE51bVBsYXllcnMoKTsgaSsrKVxuXHRcdCAge1xuXHRcdFx0ICBjb25zdCBwUGxheWVyID0gUGxheWVyLmdldFBsYXllcihpKTtcblx0XHRcdCAgYXNzZXJ0KHBQbGF5ZXIgIT0gdW5kZWZpbmVkKTtcblxuXHRcdFx0ICBpZiAoZ19BcHAhLnBvaW50Qm94KHBQbGF5ZXIubV9wb3MueCwgcFBsYXllci5tX3Bvcy55LCBcblx0XHRcdFx0XHRcdFx0XHQgICAgICAgICAgIHRoaXMubV9wb3MueCArIHRoaXMubV9iYm94VEwueCwgdGhpcy5tX3Bvcy55ICsgdGhpcy5tX2Jib3hUTC55LCBcblx0XHRcdFx0XHRcdFx0XHQgICAgICAgICAgIHRoaXMubV9wb3MueCArIHRoaXMubV9iYm94QlIueCwgdGhpcy5tX3Bvcy55ICsgdGhpcy5tX2Jib3hCUi55KSlcblx0XHRcdCAge1xuXHRcdFx0XHQgIHRoaXMubV9zdGF0ZSA9IENBUl9TVEFURS5BQ0NFTEVSQVRJTkc7XG5cdFx0XHQgIH1cblx0XHQgIH1cblx0ICB9XG5cdCAgZWxzZSBpZiAodGhpcy5tX3N0YXRlID09IENBUl9TVEFURS5BQ0NFTEVSQVRJTkcpXG5cdCAge1xuXHRcdCAgdGhpcy5tX3NwZWVkICs9IDAuMzU7XG5cdFx0ICB0aGlzLm1fcG9zLnBsdXNFcSh0aGlzLm1fdmVsLnNNdWwodGhpcy5tX3NwZWVkKSlcblxuXHRcdCAgaWYgKHRoaXMubV9zcGVlZCA+PSA4KVxuXHRcdFx0ICB0aGlzLm1fc3RhdGUgPSBDQVJfU1RBVEUuU1RPUFBJTkc7XG5cdCAgfVxuXHQgIGVsc2UgaWYgKHRoaXMubV9zdGF0ZSA9PSBDQVJfU1RBVEUuU1RPUFBJTkcpXG5cdCAge1xuXHRcdCAgdGhpcy5tX3NwZWVkIC09IDAuMjU7XG5cdFx0ICB0aGlzLm1fcG9zLnBsdXNFcSh0aGlzLm1fdmVsLnNNdWwodGhpcy5tX3NwZWVkKSlcblxuXHRcdCAgaWYgKHRoaXMubV9zcGVlZCA8PSAwKVxuXHRcdFx0ICB0aGlzLm1fc3RhdGUgPSBDQVJfU1RBVEUuU1RPUFBFRDtcblx0ICB9XG5cblx0ICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGdldCByb3RhdGlvbigpIHtcbiAgICByZXR1cm4gLXRoaXMubV92ZWwueSA+IDAgPyBNYXRoLmFzaW4odGhpcy5tX3ZlbC54KSA6IC1NYXRoLlBJIC0gTWF0aC5hc2luKHRoaXMubV92ZWwueClcbiAgfVxuICBcblx0cHJpdmF0ZSBzdGF0aWMgbV9pZGxlT2Zmc2V0cyA9IFtcblx0XHRQb2ludCgwLCAyKSxcblx0XHRQb2ludCgxLCAxKSxcblx0XHRQb2ludCgxLCAwKSxcblx0XHRQb2ludCgyLCAwKSxcblx0XHRQb2ludCgyLCAwKSxcblx0XHRQb2ludCgwLCAxKSxcblx0XHRQb2ludCgwLCAxKVxuXHRdXG59XG4iXX0=