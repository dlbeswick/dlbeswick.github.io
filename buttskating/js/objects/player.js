import { assert } from "../assert.js";
import { GameObject } from "../gameobject.js";
import { Point } from "../point2.js";
import { Particle, PARTICLE_TYPE } from "./particle.js";
import { g_App } from "../app.js";
var PLAYER_STATE;
(function (PLAYER_STATE) {
    PLAYER_STATE[PLAYER_STATE["SKATE"] = 0] = "SKATE";
    PLAYER_STATE[PLAYER_STATE["FALL"] = 1] = "FALL";
    PLAYER_STATE[PLAYER_STATE["DEAD"] = 2] = "DEAD";
})(PLAYER_STATE || (PLAYER_STATE = {}));
;
export class Player extends GameObject {
    constructor(x, y) {
        super();
        this.MAX_SKATE_SPEED = 8.0;
        this.MAX_PUSH_SPEED = 5.0;
        this.MAX_PUSH_BACK_SPEED = -2.5;
        this.m_oldpos = Point(0, 0);
        this.m_fallX = 0;
        this.m_fallY = 0;
        this.m_boundOffset = new Array(2);
        this.m_ctrlStruct = { bUp: false, bDown: false, bLeft: false, bRight: false, bFire1: false, bFire2: false };
        if (Player.m_numPlayers >= Player.MAX_PLAYERS)
            throw ("Too many players");
        this.m_lastdir = 0;
        this.m_rotvel = 0;
        this.setAnim("SKATE_STRAIGHT", 0);
        this.m_boundOffset[0] = 0;
        this.m_boundOffset[1] = 0;
        this.m_pos.x = x;
        this.m_pos.y = y;
        this.m_vel.x = 0;
        this.m_vel.y = 1;
        this.m_state = PLAYER_STATE.SKATE;
        this.m_scaleVel = 0;
        if (Player.m_numPlayers > 0)
            this.m_control = 99;
        else
            this.m_control = 0;
        Player.m_playerList[Player.m_numPlayers] = this;
        Player.m_numPlayers++;
    }
    destroy() {
        for (let i = 0; i < Player.m_numPlayers; i++) {
            if (Player.m_playerList[i] == this)
                Player.m_playerList[i] = undefined;
        }
        Player.m_numPlayers--;
    }
    // Fill in the control structure according to control type
    getCtrl() {
        this.m_ctrlStruct = {
            bUp: false,
            bDown: false,
            bLeft: false,
            bRight: false,
            bFire1: false,
            bFire2: false
        };
        if (this.m_control == 0) // Player
         {
            const pIn = g_App.m_input;
            this.m_ctrlStruct.bUp = pIn.key("ArrowUp");
            this.m_ctrlStruct.bDown = pIn.key("ArrowDown");
            this.m_ctrlStruct.bLeft = pIn.key("ArrowLeft");
            this.m_ctrlStruct.bRight = pIn.key("ArrowRight");
            this.m_ctrlStruct.bFire1 = pIn.key("J");
        }
        else if (this.m_control == 99) // AI
         {
            this.doAI();
        }
    }
    // Move this player character according to AI routines
    doAI() {
        const ahead = this.m_vel.sMul(this.m_speed).sMul(75.0);
        const sx = this.m_pos.x;
        const sy = this.m_pos.y;
        const ex = this.m_pos.x + ahead.x;
        const ey = this.m_pos.y + ahead.y;
        // Get the list of possible collisions
        const cList = g_App.m_map.getCollideLines(this.m_pos.x, this.m_pos.y, 0);
        // Check for a collision and avoid
        for (const c of cList) {
            if (g_App.lineLine(c.sx, c.sy, c.ex, c.ey, sx, sy, ex, ey)) {
                // find which side of the line we're on
                const dot = ((this.m_pos.x - sx) * (ex - sx) + (this.m_pos.x - sx) * (ey - sy));
                if (dot >= 0.0) {
                    this.m_ctrlStruct.bRight = true;
                }
                else {
                    this.m_ctrlStruct.bLeft = true;
                }
                return;
            }
        }
    }
    // Update player
    gameUpdate() {
        this.m_oldpos = this.m_pos;
        this.getCtrl();
        // Gravity
        // Scaling rep. of player
        this.m_scale = (this.m_layer * 0.025) + 1.0;
        if (this.m_state == PLAYER_STATE.SKATE) {
            // Test against map
            g_App.m_map.affectObject(this);
            if (this.m_ctrlStruct.bUp) {
                this.m_lastdir = 0;
                // brake or push
                if (this.m_speed < 0) {
                    this.setAnim("PLAYER_BRAKE", 0.25, 10);
                    this.m_speed += 0.25;
                    if (this.m_speed > 0)
                        this.m_speed = 0;
                }
                else {
                    this.setAnim("PLAYER_PUSH", 0.15, 10);
                    if (this.m_speed < 2.5) {
                        this.m_speed += 0.02;
                        if (this.m_speed > this.MAX_PUSH_SPEED)
                            this.m_speed = this.MAX_PUSH_SPEED;
                    }
                }
            }
            else if (this.m_ctrlStruct.bDown) {
                this.m_lastdir = 0;
                // brake or push
                if (this.m_speed > 0) {
                    this.setAnim("PLAYER_BRAKE", 0.25, 10);
                    this.m_speed -= 0.25;
                    if (this.m_speed < 0)
                        this.m_speed = 0;
                }
                else {
                    this.setAnim("PLAYER_PUSH_BACK", 0.15, 10);
                    if (this.m_speed > this.MAX_PUSH_BACK_SPEED)
                        this.m_speed -= 0.02;
                }
            }
            const turnVec = Point(-this.m_vel.y, this.m_vel.x);
            if (this.m_ctrlStruct.bLeft) {
                if (this.m_lastdir == 6)
                    this.m_rotvel = 0;
                this.setAnim("LEAN_LEFT", 0.25, 5);
                this.m_rotvel += 0.0001;
                if (this.m_rotvel < -1)
                    this.m_rotvel = -1;
                this.m_lastdir = 4;
                this.m_vel.minusEq(turnVec.sMul(this.m_rotvel).sMul(this.m_speed));
            }
            else if (this.m_ctrlStruct.bRight) {
                if (this.m_lastdir == 4)
                    this.m_rotvel = 0;
                this.setAnim("LEAN_RIGHT", 0.25, 5);
                this.m_rotvel -= 0.0001;
                if (this.m_rotvel > 1)
                    this.m_rotvel = 1;
                this.m_lastdir = 6;
                this.m_vel.minusEq(turnVec.sMul(this.m_rotvel).sMul(this.m_speed));
            }
            else {
                if (this.m_lastdir == 4)
                    this.setAnim("LEAN_LEFTREV", 0.25, 5);
                if (this.m_lastdir == 6)
                    this.setAnim("LEAN_RIGHTREV", 0.25, 5);
                this.m_lastdir = 0;
                this.m_rotvel = 0;
            }
            if (this.m_ctrlStruct.bFire1) {
                //m_vel[2] = 0.5f;
            }
            if (this.m_speed > this.MAX_SKATE_SPEED)
                this.m_speed = this.MAX_SKATE_SPEED;
            if (this.m_speed < -this.MAX_SKATE_SPEED)
                this.m_speed = -this.MAX_SKATE_SPEED;
            this.setAnim("SKATE_STRAIGHT", this.m_speed * 0.1, -1);
            this.m_vel.normalise();
            this.m_pos.plusEq(this.m_vel.sMul(this.m_speed));
            // Test collision
            g_App.m_map.hitTestObject(this);
        }
        else if (this.m_state == PLAYER_STATE.FALL) {
            this.setAnim("PLAYER_ROLL", 0.25);
            this.m_pos.plusEq(this.m_vel.sMul(this.m_speed));
            this.m_scale += this.m_scaleVel;
            this.m_scaleVel -= 0.05;
            if (this.m_scale < 1.0) {
                this.m_scale = 1.0;
                this.m_state = PLAYER_STATE.DEAD;
            }
        }
        else if (this.m_state == PLAYER_STATE.DEAD) {
            this.setAnim("PLAYER_DEAD", 0.01);
            if (this.animDone()) {
                this.m_pos.x = this.m_fallX;
                this.m_pos.y = this.m_fallY;
                this.m_speed = 0;
                this.m_state = PLAYER_STATE.SKATE;
                g_App.add(new Particle(this.m_pos.x, this.m_pos.y, "SPARK_SMALL", 0.01, PARTICLE_TYPE.LINGER));
                g_App.add(new Particle(this.m_pos.x, this.m_pos.y, "SPARK_SMALL", 0.01, PARTICLE_TYPE.LINGER));
                g_App.add(new Particle(this.m_pos.x, this.m_pos.y, "SPARK_SMALL", 0.01, PARTICLE_TYPE.LINGER));
                g_App.add(new Particle(this.m_pos.x, this.m_pos.y, "SPARK_SMALL", 0.01, PARTICLE_TYPE.LINGER));
                g_App.add(new Particle(this.m_pos.x, this.m_pos.y, "SPARK_SMALL", 0.01, PARTICLE_TYPE.LINGER));
            }
        }
        // move map according to player
        if (this.m_control != 99) {
            g_App.m_map.m_targetX = this.m_pos.x - 320 + (this.m_vel.x * this.m_speed * 0.25) * 100;
            g_App.m_map.m_targetY = this.m_pos.y - 240 + (this.m_vel.y * this.m_speed * 0.25) * 75;
        }
        this.animate();
        return true;
    }
    gameMapHit(sx, sy, ex, ey) {
        const hit = g_App.circleLine(this.m_pos.x, this.m_pos.y, 20, sx, sy, ex, ey);
        if (hit) {
            // Move player just past the line
            const length = Math.sqrt((this.m_pos.x - hit.x) * (this.m_pos.x - hit.x) + (this.m_pos.y - hit.y) * (this.m_pos.y - hit.y));
            const vector = Point((this.m_pos.x - hit.x) / length, (this.m_pos.y - hit.y) / length);
            this.m_pos.x = hit.x + (vector.x * 21);
            this.m_pos.y = hit.y + (vector.y * 21);
            if (this.m_speed > 0) {
                this.m_speed -= 0.25;
                if (this.m_speed < 0)
                    this.m_speed = 0;
            }
            else {
                this.m_speed += 0.25;
                if (this.m_speed > 0)
                    this.m_speed = 0;
            }
            // Make sparks
            g_App.add(new Particle(hit.x, hit.y, "SPARK_SMALL", 0.1));
            g_App.add(new Particle(hit.x, hit.y, "SPARK_SMALL", 0.1));
            g_App.add(new Particle(hit.x, hit.y, "SPARK_SMALL", 0.1));
            // If we're going really fast then fall off
            if (this.m_speed >= 5.5) {
                // Reposition ourselves on the track
                this.m_pos.x = hit.x + (vector.x * 80);
                this.m_pos.y = hit.y + (vector.y * 80);
                this.m_state = PLAYER_STATE.FALL;
                this.m_fallX = this.m_pos.x;
                this.m_fallY = this.m_pos.y;
                this.m_pos.x = hit.x;
                this.m_pos.y = hit.y;
                this.m_scaleVel = 0.5;
            }
            return true;
        }
        return false;
    }
    get rotation() {
        return this.m_vel.y > 0 ? Math.asin(-this.m_vel.x) : -Math.PI - Math.asin(-this.m_vel.x);
    }
    // return the indexed player
    static getPlayer(idx) {
        assert(idx >= 0 && idx < Player.m_numPlayers);
        return Player.m_playerList[idx];
    }
    // Return # of active players
    static getNumPlayers() {
        return Player.m_numPlayers;
    }
}
Player.MAX_PLAYERS = 4;
Player.m_numPlayers = 0;
Player.m_playerList = new Array(Player.MAX_PLAYERS);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdHMvb2JqZWN0cy9wbGF5ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGNBQWMsQ0FBQTtBQUNyQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxFQUFFLEtBQUssRUFBVSxNQUFNLGNBQWMsQ0FBQTtBQUM1QyxPQUFPLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBRWpDLElBQUssWUFLSjtBQUxELFdBQUssWUFBWTtJQUVoQixpREFBSyxDQUFBO0lBQ0wsK0NBQUksQ0FBQTtJQUNKLCtDQUFJLENBQUE7QUFDTCxDQUFDLEVBTEksWUFBWSxLQUFaLFlBQVksUUFLaEI7QUFBQSxDQUFDO0FBV0YsTUFBTSxPQUFPLE1BQU8sU0FBUSxVQUFVO0lBc0JwQyxZQUFZLENBQVMsRUFBRSxDQUFTO1FBQzlCLEtBQUssRUFBRSxDQUFBO1FBckJBLG9CQUFlLEdBQUksR0FBRyxDQUFBO1FBQ3RCLG1CQUFjLEdBQUksR0FBRyxDQUFBO1FBQ3JCLHdCQUFtQixHQUFHLENBQUMsR0FBRyxDQUFBO1FBS3BDLGFBQVEsR0FBVyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFBO1FBSTdCLFlBQU8sR0FBVyxDQUFDLENBQUE7UUFDbkIsWUFBTyxHQUFXLENBQUMsQ0FBQTtRQUVuQixrQkFBYSxHQUFHLElBQUksS0FBSyxDQUFTLENBQUMsQ0FBQyxDQUFDO1FBRTdCLGlCQUFZLEdBQVUsRUFBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxF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WyJpbXBvcnQgeyBhc3NlcnQgfSBmcm9tIFwiLi4vYXNzZXJ0LmpzXCJcbmltcG9ydCB7IEdhbWVPYmplY3QgfSBmcm9tIFwiLi4vZ2FtZW9iamVjdC5qc1wiXG5pbXBvcnQgeyBQb2ludCwgUG9pbnQyIH0gZnJvbSBcIi4uL3BvaW50Mi5qc1wiXG5pbXBvcnQgeyBQYXJ0aWNsZSwgUEFSVElDTEVfVFlQRSB9IGZyb20gXCIuL3BhcnRpY2xlLmpzXCJcbmltcG9ydCB7IGdfQXBwIH0gZnJvbSBcIi4uL2FwcC5qc1wiXG5cbmVudW0gUExBWUVSX1NUQVRFXG57XG5cdFNLQVRFLFxuXHRGQUxMLFxuXHRERUFEXG59O1xuXG50eXBlIHNDdHJsID0ge1xuXHRiVXA6IGJvb2xlYW5cblx0YkRvd246IGJvb2xlYW5cblx0YkxlZnQ6IGJvb2xlYW5cblx0YlJpZ2h0OiBib29sZWFuXG5cdGJGaXJlMTogYm9vbGVhblxuXHRiRmlyZTI6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGNsYXNzIFBsYXllciBleHRlbmRzIEdhbWVPYmplY3Qge1xuICBzdGF0aWMgcmVhZG9ubHkgTUFYX1BMQVlFUlMgPSA0XG4gIHJlYWRvbmx5IE1BWF9TS0FURV9TUEVFRFx0XHQ9IDguMFxuICByZWFkb25seSBNQVhfUFVTSF9TUEVFRFx0XHQ9IDUuMFxuICByZWFkb25seSBNQVhfUFVTSF9CQUNLX1NQRUVEXHQ9IC0yLjVcblxuXHRtX2xhc3RkaXI6IG51bWJlclx0XHQvLyBVc2VkIHRvIHBsYXkgYW4gYW5pbSBvZiByZXR1cm5pbmcgdG8gY2VudGVyLCBhZnRlciB0dXJuXG5cdG1fY29udHJvbDogbnVtYmVyXHRcdC8vIHBsYXllciAwLCAxLCBvciA5OSBmb3IgQUlcblx0bV9yb3R2ZWw6IG51bWJlclxuXHRtX29sZHBvczogUG9pbnQyID0gUG9pbnQoMCwwKVxuXHRtX3N0YXRlOiBQTEFZRVJfU1RBVEVcblx0bV9zY2FsZVZlbDogbnVtYmVyO1xuXG5cdG1fZmFsbFg6IG51bWJlciA9IDBcblx0bV9mYWxsWTogbnVtYmVyID0gMFxuXG5cdG1fYm91bmRPZmZzZXQgPSBuZXcgQXJyYXk8bnVtYmVyPigyKTtcblxuXHRwcml2YXRlIG1fY3RybFN0cnVjdDogc0N0cmwgPSB7YlVwOiBmYWxzZSwgYkRvd246IGZhbHNlLCBiTGVmdDogZmFsc2UsIGJSaWdodDogZmFsc2UsIGJGaXJlMTogZmFsc2UsIGJGaXJlMjogZmFsc2V9XG5cdHByaXZhdGUgc3RhdGljIG1fbnVtUGxheWVyczogbnVtYmVyID0gMFxuXHRzdGF0aWMgbV9wbGF5ZXJMaXN0ID0gbmV3IEFycmF5PFBsYXllcnx1bmRlZmluZWQ+KFBsYXllci5NQVhfUExBWUVSUylcblxuICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHN1cGVyKClcbiAgICBcblx0ICBpZiAoUGxheWVyLm1fbnVtUGxheWVycyA+PSBQbGF5ZXIuTUFYX1BMQVlFUlMpXG5cdFx0ICB0aHJvdyhcIlRvbyBtYW55IHBsYXllcnNcIilcblxuXHQgIHRoaXMubV9sYXN0ZGlyID0gMFxuXHQgIHRoaXMubV9yb3R2ZWwgPSAwXG5cdCAgdGhpcy5zZXRBbmltKFwiU0tBVEVfU1RSQUlHSFRcIiwwKVxuXG5cdCAgdGhpcy5tX2JvdW5kT2Zmc2V0WzBdID0gMFxuXHQgIHRoaXMubV9ib3VuZE9mZnNldFsxXSA9IDBcblxuXHQgIHRoaXMubV9wb3MueCA9IHg7XG5cdCAgdGhpcy5tX3Bvcy55ID0geTtcblx0ICB0aGlzLm1fdmVsLnggPSAwO1xuXHQgIHRoaXMubV92ZWwueSA9IDE7XG5cblx0ICB0aGlzLm1fc3RhdGUgPSBQTEFZRVJfU1RBVEUuU0tBVEVcblxuXHQgIHRoaXMubV9zY2FsZVZlbCA9IDBcblxuXHQgIGlmIChQbGF5ZXIubV9udW1QbGF5ZXJzID4gMClcblx0XHQgIHRoaXMubV9jb250cm9sID0gOTlcblx0ICBlbHNlXG5cdFx0ICB0aGlzLm1fY29udHJvbCA9IDBcblxuXHQgIFBsYXllci5tX3BsYXllckxpc3RbUGxheWVyLm1fbnVtUGxheWVyc10gPSB0aGlzXG5cblx0ICBQbGF5ZXIubV9udW1QbGF5ZXJzKytcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG5cdCAgZm9yIChsZXQgaT0wOyBpIDwgUGxheWVyLm1fbnVtUGxheWVyczsgaSsrKSB7XG5cdFx0ICBpZiAoUGxheWVyLm1fcGxheWVyTGlzdFtpXSA9PSB0aGlzKVxuXHRcdFx0ICBQbGF5ZXIubV9wbGF5ZXJMaXN0W2ldID0gdW5kZWZpbmVkO1xuXHQgIH1cblx0ICBQbGF5ZXIubV9udW1QbGF5ZXJzLS07XG4gIH1cblxuICAvLyBGaWxsIGluIHRoZSBjb250cm9sIHN0cnVjdHVyZSBhY2NvcmRpbmcgdG8gY29udHJvbCB0eXBlXG4gIGdldEN0cmwoKSB7XG5cdCAgdGhpcy5tX2N0cmxTdHJ1Y3QgPSB7XG4gICAgXHRiVXA6IGZhbHNlLFxuXHQgICAgYkRvd246IGZhbHNlLFxuXHQgICAgYkxlZnQ6IGZhbHNlLFxuXHQgICAgYlJpZ2h0OiBmYWxzZSxcblx0ICAgIGJGaXJlMTogZmFsc2UsXG5cdCAgICBiRmlyZTI6IGZhbHNlXG4gICAgfVxuXG5cdCAgaWYgKHRoaXMubV9jb250cm9sID09IDApXHRcdFx0Ly8gUGxheWVyXG5cdCAge1xuXHRcdCAgY29uc3QgcEluID0gZ19BcHAhLm1faW5wdXQ7XG5cblx0XHQgIHRoaXMubV9jdHJsU3RydWN0LmJVcCA9IHBJbi5rZXkoXCJBcnJvd1VwXCIpO1xuXHRcdCAgdGhpcy5tX2N0cmxTdHJ1Y3QuYkRvd24gPSBwSW4ua2V5KFwiQXJyb3dEb3duXCIpO1xuXHRcdCAgdGhpcy5tX2N0cmxTdHJ1Y3QuYkxlZnQgPSBwSW4ua2V5KFwiQXJyb3dMZWZ0XCIpO1xuXHRcdCAgdGhpcy5tX2N0cmxTdHJ1Y3QuYlJpZ2h0ID0gcEluLmtleShcIkFycm93UmlnaHRcIik7XG5cdFx0ICB0aGlzLm1fY3RybFN0cnVjdC5iRmlyZTEgPSBwSW4ua2V5KFwiSlwiKTtcblx0ICB9XG5cdCAgZWxzZSBpZiAodGhpcy5tX2NvbnRyb2wgPT0gOTkpXHQvLyBBSVxuXHQgIHtcblx0XHQgIHRoaXMuZG9BSSgpO1xuXHQgIH1cbiAgfVxuXG4gIC8vIE1vdmUgdGhpcyBwbGF5ZXIgY2hhcmFjdGVyIGFjY29yZGluZyB0byBBSSByb3V0aW5lc1xuICBkb0FJKCkge1xuXHQgIGNvbnN0IGFoZWFkID0gdGhpcy5tX3ZlbC5zTXVsKHRoaXMubV9zcGVlZCkuc011bCg3NS4wKTtcblxuXHQgIGNvbnN0IHN4ID0gdGhpcy5tX3Bvcy54O1xuXHQgIGNvbnN0IHN5ID0gdGhpcy5tX3Bvcy55O1xuXHQgIGNvbnN0IGV4ID0gdGhpcy5tX3Bvcy54ICsgYWhlYWQueDtcblx0ICBjb25zdCBleSA9IHRoaXMubV9wb3MueSArIGFoZWFkLnk7XG5cblx0ICAvLyBHZXQgdGhlIGxpc3Qgb2YgcG9zc2libGUgY29sbGlzaW9uc1xuXHQgIGNvbnN0IGNMaXN0ID0gZ19BcHAhLm1fbWFwLmdldENvbGxpZGVMaW5lcyh0aGlzLm1fcG9zLngsIHRoaXMubV9wb3MueSwgMClcblxuXHQgIC8vIENoZWNrIGZvciBhIGNvbGxpc2lvbiBhbmQgYXZvaWRcblx0ICBmb3IgKGNvbnN0IGMgb2YgY0xpc3QpXG5cdCAge1xuXHRcdCAgaWYgKGdfQXBwIS5saW5lTGluZShjLnN4LCBjLnN5LCBjLmV4LCBjLmV5LCBzeCwgc3ksIGV4LCBleSkpXG5cdFx0ICB7XG5cdFx0XHQgIC8vIGZpbmQgd2hpY2ggc2lkZSBvZiB0aGUgbGluZSB3ZSdyZSBvblxuXHRcdFx0ICBjb25zdCBkb3QgPSAoKHRoaXMubV9wb3MueCAtIHN4KSAqIChleCAtIHN4KSArICh0aGlzLm1fcG9zLnggLSBzeCkgKiAoZXkgLSBzeSkpO1xuXG5cdFx0XHQgIGlmIChkb3QgPj0gMC4wKVxuXHRcdFx0ICB7XG5cdFx0XHRcdCAgdGhpcy5tX2N0cmxTdHJ1Y3QuYlJpZ2h0ID0gdHJ1ZTtcblx0XHRcdCAgfVxuXHRcdFx0ICBlbHNlXG5cdFx0XHQgIHtcblx0XHRcdFx0ICB0aGlzLm1fY3RybFN0cnVjdC5iTGVmdCA9IHRydWU7XG5cdFx0XHQgIH1cblxuXHRcdFx0ICByZXR1cm47XG5cdFx0ICB9XG5cdCAgfVxuICB9XG5cblxuICAvLyBVcGRhdGUgcGxheWVyXG4gIGdhbWVVcGRhdGUoKTogYm9vbGVhbiB7XG5cdCAgdGhpcy5tX29sZHBvcyA9IHRoaXMubV9wb3M7XG5cblx0ICB0aGlzLmdldEN0cmwoKTtcblxuXHQgIC8vIEdyYXZpdHlcblxuXHQgIC8vIFNjYWxpbmcgcmVwLiBvZiBwbGF5ZXJcblxuXHQgIHRoaXMubV9zY2FsZSA9ICh0aGlzLm1fbGF5ZXIgKiAwLjAyNSkgKyAxLjA7XG5cblx0ICBpZiAodGhpcy5tX3N0YXRlID09IFBMQVlFUl9TVEFURS5TS0FURSlcblx0ICB7XG5cdFx0ICAvLyBUZXN0IGFnYWluc3QgbWFwXG5cdFx0ICBnX0FwcCEubV9tYXAuYWZmZWN0T2JqZWN0KHRoaXMpO1xuXG5cdFx0ICBpZiAodGhpcy5tX2N0cmxTdHJ1Y3QuYlVwKVxuXHRcdCAge1xuXHRcdFx0ICB0aGlzLm1fbGFzdGRpciA9IDA7XG5cblx0XHRcdCAgLy8gYnJha2Ugb3IgcHVzaFxuXHRcdFx0ICBpZiAodGhpcy5tX3NwZWVkIDwgMClcblx0XHRcdCAge1xuXHRcdFx0XHQgIHRoaXMuc2V0QW5pbShcIlBMQVlFUl9CUkFLRVwiLCAwLjI1LCAxMCk7XG5cblx0XHRcdFx0ICB0aGlzLm1fc3BlZWQgKz0gMC4yNTtcblx0XHRcdFx0ICBpZiAodGhpcy5tX3NwZWVkID4gMClcblx0XHRcdFx0XHQgIHRoaXMubV9zcGVlZCA9IDA7XG5cdFx0XHQgIH1cblx0XHRcdCAgZWxzZVxuXHRcdFx0ICB7XG5cdFx0XHRcdCAgdGhpcy5zZXRBbmltKFwiUExBWUVSX1BVU0hcIiwgMC4xNSwgMTApO1xuXG5cdFx0XHRcdCAgaWYgKHRoaXMubV9zcGVlZCA8IDIuNSlcblx0XHRcdFx0ICB7XG5cdFx0XHRcdFx0ICB0aGlzLm1fc3BlZWQgKz0gMC4wMjtcblx0XHRcdFx0XHQgIGlmICh0aGlzLm1fc3BlZWQgPiB0aGlzLk1BWF9QVVNIX1NQRUVEKVxuXHRcdFx0XHRcdFx0ICB0aGlzLm1fc3BlZWQgPSB0aGlzLk1BWF9QVVNIX1NQRUVEO1xuXHRcdFx0XHQgIH1cblx0XHRcdCAgfVxuXHRcdCAgfVxuXHRcdCAgZWxzZSBpZiAodGhpcy5tX2N0cmxTdHJ1Y3QuYkRvd24pXG5cdFx0ICB7XG5cdFx0XHQgIHRoaXMubV9sYXN0ZGlyID0gMDtcblxuXHRcdFx0ICAvLyBicmFrZSBvciBwdXNoXG5cdFx0XHQgIGlmICh0aGlzLm1fc3BlZWQgPiAwKVxuXHRcdFx0ICB7XG5cdFx0XHRcdCAgdGhpcy5zZXRBbmltKFwiUExBWUVSX0JSQUtFXCIsIDAuMjUsIDEwKTtcblxuXHRcdFx0XHQgIHRoaXMubV9zcGVlZCAtPSAwLjI1O1xuXHRcdFx0XHQgIGlmICh0aGlzLm1fc3BlZWQgPCAwKVxuXHRcdFx0XHRcdCAgdGhpcy5tX3NwZWVkID0gMDtcblx0XHRcdCAgfVxuXHRcdFx0ICBlbHNlXG5cdFx0XHQgIHtcblx0XHRcdFx0ICB0aGlzLnNldEFuaW0oXCJQTEFZRVJfUFVTSF9CQUNLXCIsIDAuMTUsIDEwKTtcblxuXHRcdFx0XHQgIGlmICh0aGlzLm1fc3BlZWQgPiB0aGlzLk1BWF9QVVNIX0JBQ0tfU1BFRUQpXG5cdFx0XHRcdFx0ICB0aGlzLm1fc3BlZWQgLT0gMC4wMjtcblx0XHRcdCAgfVxuXHRcdCAgfVxuXHRcdFx0XG5cblx0XHQgIGNvbnN0IHR1cm5WZWMgPSBQb2ludCgtdGhpcy5tX3ZlbC55LCB0aGlzLm1fdmVsLngpO1xuXG5cdFx0ICBpZiAodGhpcy5tX2N0cmxTdHJ1Y3QuYkxlZnQpXG5cdFx0ICB7XG5cdFx0XHQgIGlmICh0aGlzLm1fbGFzdGRpciA9PSA2KVxuXHRcdFx0XHQgIHRoaXMubV9yb3R2ZWwgPSAwO1xuXHRcdFx0ICB0aGlzLnNldEFuaW0oXCJMRUFOX0xFRlRcIiwgMC4yNSwgNSk7XG5cdFx0XHQgIFxuXHRcdFx0ICB0aGlzLm1fcm90dmVsICs9IDAuMDAwMTtcblx0XHRcdCAgaWYgKHRoaXMubV9yb3R2ZWwgPCAtMSlcblx0XHRcdFx0ICB0aGlzLm1fcm90dmVsID0gLTE7XG5cdFx0XHQgIFxuXHRcdFx0ICB0aGlzLm1fbGFzdGRpciA9IDQ7XG5cblx0XHRcdCAgdGhpcy5tX3ZlbC5taW51c0VxKHR1cm5WZWMuc011bCh0aGlzLm1fcm90dmVsKS5zTXVsKHRoaXMubV9zcGVlZCkpO1xuXHRcdCAgfVxuXHRcdCAgZWxzZSBpZiAodGhpcy5tX2N0cmxTdHJ1Y3QuYlJpZ2h0KVxuXHRcdCAge1xuXHRcdFx0ICBpZiAodGhpcy5tX2xhc3RkaXIgPT0gNClcblx0XHRcdFx0ICB0aGlzLm1fcm90dmVsID0gMDtcblx0XHRcdCAgdGhpcy5zZXRBbmltKFwiTEVBTl9SSUdIVFwiLCAwLjI1LCA1KTtcblxuXHRcdFx0ICB0aGlzLm1fcm90dmVsIC09IDAuMDAwMTtcblx0XHRcdCAgaWYgKHRoaXMubV9yb3R2ZWwgPiAxKVxuXHRcdFx0XHQgIHRoaXMubV9yb3R2ZWwgPSAxO1xuXHRcdFx0ICBcblx0XHRcdCAgdGhpcy5tX2xhc3RkaXIgPSA2O1xuXG5cdFx0XHQgIHRoaXMubV92ZWwubWludXNFcSh0dXJuVmVjLnNNdWwodGhpcy5tX3JvdHZlbCkuc011bCh0aGlzLm1fc3BlZWQpKTtcblx0XHQgIH1cblx0XHQgIGVsc2Vcblx0XHQgIHtcblx0XHRcdCAgaWYgKHRoaXMubV9sYXN0ZGlyID09IDQpXG5cdFx0XHRcdCAgdGhpcy5zZXRBbmltKFwiTEVBTl9MRUZUUkVWXCIsIDAuMjUsIDUpO1xuXHRcdFx0ICBpZiAodGhpcy5tX2xhc3RkaXIgPT0gNilcblx0XHRcdFx0ICB0aGlzLnNldEFuaW0oXCJMRUFOX1JJR0hUUkVWXCIsIDAuMjUsIDUpO1xuXG5cdFx0XHQgIHRoaXMubV9sYXN0ZGlyID0gMDtcblx0XHRcdCAgdGhpcy5tX3JvdHZlbCA9IDA7XG5cdFx0ICB9XG5cblx0XHQgIGlmICh0aGlzLm1fY3RybFN0cnVjdC5iRmlyZTEpXG5cdFx0ICB7XG5cdFx0XHQgIC8vbV92ZWxbMl0gPSAwLjVmO1xuXHRcdCAgfVxuXG5cdFx0ICBpZiAodGhpcy5tX3NwZWVkID4gdGhpcy5NQVhfU0tBVEVfU1BFRUQpXG5cdFx0ICAgIHRoaXMubV9zcGVlZCA9IHRoaXMuTUFYX1NLQVRFX1NQRUVEO1xuXHRcdCAgaWYgKHRoaXMubV9zcGVlZCA8IC10aGlzLk1BWF9TS0FURV9TUEVFRClcblx0XHQgICAgdGhpcy5tX3NwZWVkID0gLXRoaXMuTUFYX1NLQVRFX1NQRUVEO1xuXG5cdFx0ICB0aGlzLnNldEFuaW0oXCJTS0FURV9TVFJBSUdIVFwiLCB0aGlzLm1fc3BlZWQgKiAwLjEsIC0xKTtcblxuXHRcdCAgdGhpcy5tX3ZlbC5ub3JtYWxpc2UoKTtcblxuXHRcdCAgdGhpcy5tX3Bvcy5wbHVzRXEodGhpcy5tX3ZlbC5zTXVsKHRoaXMubV9zcGVlZCkpO1xuXHQgICAgXG5cdFx0ICAvLyBUZXN0IGNvbGxpc2lvblxuXHRcdCAgZ19BcHAhLm1fbWFwLmhpdFRlc3RPYmplY3QodGhpcyk7XG5cdCAgfVxuXHQgIGVsc2UgaWYgKHRoaXMubV9zdGF0ZSA9PSBQTEFZRVJfU1RBVEUuRkFMTClcblx0ICB7XG5cdFx0ICB0aGlzLnNldEFuaW0oXCJQTEFZRVJfUk9MTFwiLCAwLjI1KTtcblx0XHQgIFxuXHRcdCAgdGhpcy5tX3Bvcy5wbHVzRXEodGhpcy5tX3ZlbC5zTXVsKHRoaXMubV9zcGVlZCkpO1xuXG5cdFx0ICB0aGlzLm1fc2NhbGUgKz0gdGhpcy5tX3NjYWxlVmVsO1xuXG5cdFx0ICB0aGlzLm1fc2NhbGVWZWwgLT0gMC4wNTtcblxuXHRcdCAgaWYgKHRoaXMubV9zY2FsZSA8IDEuMClcblx0XHQgIHtcblx0XHRcdCAgdGhpcy5tX3NjYWxlID0gMS4wO1xuXHRcdFx0ICB0aGlzLm1fc3RhdGUgPSBQTEFZRVJfU1RBVEUuREVBRDtcblx0XHQgIH1cblx0ICB9XG5cdCAgZWxzZSBpZiAodGhpcy5tX3N0YXRlID09IFBMQVlFUl9TVEFURS5ERUFEKVxuXHQgIHtcblx0XHQgIHRoaXMuc2V0QW5pbShcIlBMQVlFUl9ERUFEXCIsIDAuMDEpO1xuXG5cdFx0ICBpZiAodGhpcy5hbmltRG9uZSgpKVxuXHRcdCAge1xuXHRcdFx0ICB0aGlzLm1fcG9zLnggPSB0aGlzLm1fZmFsbFg7XG5cdFx0XHQgIHRoaXMubV9wb3MueSA9IHRoaXMubV9mYWxsWTtcblx0XHRcdCAgdGhpcy5tX3NwZWVkID0gMDtcblx0XHRcdCAgdGhpcy5tX3N0YXRlID0gUExBWUVSX1NUQVRFLlNLQVRFO1xuXG5cdFx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKHRoaXMubV9wb3MueCwgdGhpcy5tX3Bvcy55LCBcIlNQQVJLX1NNQUxMXCIsIDAuMDEsIFBBUlRJQ0xFX1RZUEUuTElOR0VSKSk7XG5cdFx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKHRoaXMubV9wb3MueCwgdGhpcy5tX3Bvcy55LCBcIlNQQVJLX1NNQUxMXCIsIDAuMDEsIFBBUlRJQ0xFX1RZUEUuTElOR0VSKSk7XG5cdFx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKHRoaXMubV9wb3MueCwgdGhpcy5tX3Bvcy55LCBcIlNQQVJLX1NNQUxMXCIsIDAuMDEsIFBBUlRJQ0xFX1RZUEUuTElOR0VSKSk7XG5cdFx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKHRoaXMubV9wb3MueCwgdGhpcy5tX3Bvcy55LCBcIlNQQVJLX1NNQUxMXCIsIDAuMDEsIFBBUlRJQ0xFX1RZUEUuTElOR0VSKSk7XG5cdFx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKHRoaXMubV9wb3MueCwgdGhpcy5tX3Bvcy55LCBcIlNQQVJLX1NNQUxMXCIsIDAuMDEsIFBBUlRJQ0xFX1RZUEUuTElOR0VSKSk7XG5cdFx0ICB9XG5cdCAgfVxuXG5cdCAgLy8gbW92ZSBtYXAgYWNjb3JkaW5nIHRvIHBsYXllclxuXG5cdCAgaWYgKHRoaXMubV9jb250cm9sICE9IDk5KVxuXHQgIHtcblx0XHQgIGdfQXBwIS5tX21hcC5tX3RhcmdldFggPSB0aGlzLm1fcG9zLnggLSAzMjAgKyAodGhpcy5tX3ZlbC54ICogdGhpcy5tX3NwZWVkICogMC4yNSkgKiAxMDA7XG5cdFx0ICBnX0FwcCEubV9tYXAubV90YXJnZXRZID0gdGhpcy5tX3Bvcy55IC0gMjQwICsgKHRoaXMubV92ZWwueSAqIHRoaXMubV9zcGVlZCAqIDAuMjUpICogNzU7XG5cdCAgfVxuXG5cdCAgdGhpcy5hbmltYXRlKCk7XG5cblx0ICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGdhbWVNYXBIaXQoc3g6IG51bWJlciwgc3k6IG51bWJlciwgZXg6IG51bWJlciwgZXk6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGhpdCA9IGdfQXBwIS5jaXJjbGVMaW5lKHRoaXMubV9wb3MueCwgdGhpcy5tX3Bvcy55LCAyMCwgc3gsIHN5LCBleCwgZXkpXG5cdCAgaWYgKGhpdClcblx0ICB7XG5cdFx0ICAvLyBNb3ZlIHBsYXllciBqdXN0IHBhc3QgdGhlIGxpbmVcblx0XHQgIGNvbnN0IGxlbmd0aCA9IE1hdGguc3FydChcbiAgICAgICAgKHRoaXMubV9wb3MueCAtIGhpdC54KSAqICh0aGlzLm1fcG9zLnggLSBoaXQueCkgKyAodGhpcy5tX3Bvcy55IC0gaGl0LnkpICogKHRoaXMubV9wb3MueSAtIGhpdC55KVxuICAgICAgKTtcblxuXHRcdCAgY29uc3QgdmVjdG9yID0gUG9pbnQoXG4gICAgICAgICh0aGlzLm1fcG9zLnggLSBoaXQueCkgLyBsZW5ndGgsXG5cdFx0ICAgICh0aGlzLm1fcG9zLnkgLSBoaXQueSkgLyBsZW5ndGhcbiAgICAgIClcblxuXHRcdCAgdGhpcy5tX3Bvcy54ID0gaGl0LnggKyAodmVjdG9yLnggKiAyMSk7XG5cdFx0ICB0aGlzLm1fcG9zLnkgPSBoaXQueSArICh2ZWN0b3IueSAqIDIxKTtcblxuXHRcdCAgaWYgKHRoaXMubV9zcGVlZCA+IDApXG5cdFx0ICB7XG5cdFx0XHQgIHRoaXMubV9zcGVlZCAtPSAwLjI1O1xuXHRcdFx0ICBpZiAodGhpcy5tX3NwZWVkIDwgMClcblx0XHRcdFx0ICB0aGlzLm1fc3BlZWQgPSAwO1xuXHRcdCAgfVxuXHRcdCAgZWxzZVxuXHRcdCAge1xuXHRcdFx0ICB0aGlzLm1fc3BlZWQgKz0gMC4yNTtcblx0XHRcdCAgaWYgKHRoaXMubV9zcGVlZCA+IDApXG5cdFx0XHRcdCAgdGhpcy5tX3NwZWVkID0gMDtcblx0XHQgIH1cblxuXHRcdCAgLy8gTWFrZSBzcGFya3Ncblx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKGhpdC54LCBoaXQueSwgXCJTUEFSS19TTUFMTFwiLCAwLjEpKTtcblx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKGhpdC54LCBoaXQueSwgXCJTUEFSS19TTUFMTFwiLCAwLjEpKTtcblx0XHQgIGdfQXBwIS5hZGQobmV3IFBhcnRpY2xlKGhpdC54LCBoaXQueSwgXCJTUEFSS19TTUFMTFwiLCAwLjEpKTtcblxuXHRcdCAgLy8gSWYgd2UncmUgZ29pbmcgcmVhbGx5IGZhc3QgdGhlbiBmYWxsIG9mZlxuXHRcdCAgaWYgKHRoaXMubV9zcGVlZCA+PSA1LjUpXG5cdFx0ICB7XG5cdFx0XHQgIC8vIFJlcG9zaXRpb24gb3Vyc2VsdmVzIG9uIHRoZSB0cmFja1xuXHRcdFx0ICB0aGlzLm1fcG9zLnggPSBoaXQueCArICh2ZWN0b3IueCAqIDgwKTtcblx0XHRcdCAgdGhpcy5tX3Bvcy55ID0gaGl0LnkgKyAodmVjdG9yLnkgKiA4MCk7XG5cblx0XHRcdCAgdGhpcy5tX3N0YXRlID0gUExBWUVSX1NUQVRFLkZBTEw7XG5cdFx0XHQgIHRoaXMubV9mYWxsWCA9IHRoaXMubV9wb3MueDtcblx0XHRcdCAgdGhpcy5tX2ZhbGxZID0gdGhpcy5tX3Bvcy55O1xuXHRcdFx0ICB0aGlzLm1fcG9zLnggPSBoaXQueDtcblx0XHRcdCAgdGhpcy5tX3Bvcy55ID0gaGl0Lnk7XG5cdFx0XHQgIHRoaXMubV9zY2FsZVZlbCA9IDAuNTtcblx0XHQgIH1cblx0XHQgIFxuXHRcdCAgcmV0dXJuIHRydWU7XG5cdCAgfVxuXG5cdCAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZ2V0IHJvdGF0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLm1fdmVsLnkgPiAwID8gTWF0aC5hc2luKC10aGlzLm1fdmVsLngpIDogLU1hdGguUEkgLSBNYXRoLmFzaW4oLXRoaXMubV92ZWwueClcbiAgfVxuXG4gIC8vIHJldHVybiB0aGUgaW5kZXhlZCBwbGF5ZXJcbiAgc3RhdGljIGdldFBsYXllcihpZHg6IG51bWJlcik6IFBsYXllcnx1bmRlZmluZWRcbiAge1xuXHQgIGFzc2VydChpZHggPj0gMCAmJiBpZHggPCBQbGF5ZXIubV9udW1QbGF5ZXJzKTtcblxuXHQgIHJldHVybiBQbGF5ZXIubV9wbGF5ZXJMaXN0W2lkeF07XG4gIH1cblxuICAvLyBSZXR1cm4gIyBvZiBhY3RpdmUgcGxheWVyc1xuICBzdGF0aWMgZ2V0TnVtUGxheWVycygpXG4gIHtcblx0ICByZXR1cm4gUGxheWVyLm1fbnVtUGxheWVycztcbiAgfVxufVxuIl19