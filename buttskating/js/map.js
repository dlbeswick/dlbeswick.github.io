var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import * as array from "./array.js";
import { assert } from "./assert.js";
import { Binstream } from "./binstream.js";
import { MapTester } from "./maptester.js";
import { Pictures } from "./pictures.js";
import { g_App } from "./app.js";
import { Point, Point2 } from "./point2.js";
import { addObjectType } from "./objects/serialize.js";
const MAP_LAYER_INC = 0.0125;
var mapType;
(function (mapType) {
    mapType[mapType["MAP_DOWN"] = 0] = "MAP_DOWN";
    mapType[mapType["MAP_DOWNRIGHT"] = 1] = "MAP_DOWNRIGHT";
    mapType[mapType["MAP_RIGHT"] = 2] = "MAP_RIGHT";
    mapType[mapType["MAP_UPRIGHT"] = 3] = "MAP_UPRIGHT";
    mapType[mapType["MAP_UP"] = 4] = "MAP_UP";
    mapType[mapType["MAP_UPLEFT"] = 5] = "MAP_UPLEFT";
    mapType[mapType["MAP_LEFT"] = 6] = "MAP_LEFT";
    mapType[mapType["MAP_DOWNLEFT"] = 7] = "MAP_DOWNLEFT";
    mapType[mapType["MAP_FLAT"] = 8] = "MAP_FLAT";
    mapType[mapType["MAP_NOFRICTION"] = 9] = "MAP_NOFRICTION";
})(mapType || (mapType = {}));
;
class sMapCollide {
    constructor(sx, sy, ex, ey, layer) {
        this.sx = sx;
        this.sy = sy;
        this.ex = ex;
        this.ey = ey;
        this.layer = layer;
    }
}
;
export class sMapPart {
    constructor(x, y, w, h, layer, type, texmap, ptex = -1) {
        this.x = x;
        this.y = y;
        this.w = w;
        this.h = h;
        this.layer = layer;
        this.type = type;
        this.colRec = [undefined, undefined, undefined, undefined];
        this.order = 0;
        if (texmap instanceof CMap) {
            assert(ptex != -1);
            this.tex = texmap.getTile(ptex);
        }
        else {
            this.tex = texmap;
        }
    }
    get width() { assert(this.tex); return this.w * this.tex.width; }
    get height() { assert(this.tex); return this.h * this.tex.height; }
    transX(pMap) { return pMap.mapXToScreen(this.x, this.layer); }
    transY(pMap) { return pMap.mapYToScreen(this.y, this.layer); }
    // test against the map's camera
    testBBox(pPart) {
        return g_App.boxBox(pPart.x, pPart.y, pPart.x + pPart.width, pPart.y + pPart.height, this.x, this.y, this.x + g_App.canvas.width, this.y + g_App.canvas.height);
    }
}
export class CMap {
    constructor(ctx) {
        this.ctx = ctx;
        this.debug = false;
        this.m_targetX = 0;
        this.m_targetY = 0;
        this.m_x = 0;
        this.m_y = 0;
        this.m_pLayerDrawRot = [];
        this.m_movePos = [0, 0];
        //TBD private void snapRegion(sMapPart *from, bool bVert);
        this.m_mapParts = []; // owner
        this.m_mapCollide = []; // owner
        this.m_splitParts = []; // point to non-owner
        this.m_splitCollide = []; // point to non-owner
        this.m_editObjects = [];
        this.m_editTileOrder = [];
        this.m_mapTester = new MapTester();
        // map extents
        this.m_minx = -9999999;
        this.m_miny = -9999999;
        this.m_splitWidth = 0;
        this.m_splitHeight = 0;
        this.m_segSizeX = 640 * 4;
        this.m_segSizeY = 480 * 4;
    }
    init(bEdit) {
        return __awaiter(this, void 0, void 0, function* () {
            this.m_x = 0;
            this.m_y = 0;
            this.m_targetX = 0;
            this.m_targetY = 0;
            this.m_movePos[0] = 0;
            this.m_movePos[1] = 0;
            // Init GFX
            // Tile coords
            this.m_pictures = yield Pictures.load("media/tiles.txt", this.ctx);
            this.m_editTileOrder = this.m_pictures.order;
            this.m_tiletypes = yield Pictures.load("media/tiletypes.txt");
            if (bEdit) {
                this.m_objecttypes = yield Pictures.load("media/objecttypes.txt");
            }
        });
    }
    drawObj(ctx, o) {
        this.resetTransform(ctx);
        ctx.translate(-this.m_x, -this.m_y);
        o.draw(this.ctx);
    }
    resetTransform(ctx) {
        ctx.resetTransform();
        if (this.debug) {
            ctx.translate((640 - 640 * 0.25) / 2, (480 - 480 * 0.25) / 2);
            ctx.scale(0.25, 0.25);
            ctx.strokeStyle = "red";
            ctx.strokeRect(0, 0, 640, 480);
        }
    }
    draw(ctx, startLayer, endLayer) {
        let i = 0;
        let q = 0;
        assert(startLayer >= 0);
        while (q != this.m_mapTester.getColList().length && this.m_mapTester.getColList()[q].layer < startLayer)
            q++;
        let lastLayer = 0;
        for (; q < this.m_mapTester.getColList().length; q++) {
            const m = this.m_mapTester.getColList()[q];
            if (m.layer == endLayer)
                return;
            const f = m.tex;
            assert(f && f.pattern);
            this.resetTransform(ctx);
            ctx.fillStyle = f.pattern;
            const wx = this.mapXToScreen(m.x, m.layer);
            const wy = this.mapYToScreen(m.y, m.layer);
            f.pattern.setTransform(new DOMMatrix().translate(wx, wy));
            ctx.fillRect(wx, wy, m.width, m.height);
            // Now draw objects that are 'layered' if the layer has changed
            if (lastLayer != m.layer) {
                lastLayer = m.layer;
                ctx.fillStyle = "none";
                for (const i in this.m_pLayerDrawRot) {
                    const obj = this.m_pLayerDrawRot[i];
                    if (obj.m_layer == lastLayer) {
                        this.drawObj(ctx, obj);
                        delete this.m_pLayerDrawRot[i];
                    }
                }
            }
        }
        // Draw any leftover layer objects
        for (const o of this.m_pLayerDrawRot) {
            if (o) {
                this.drawObj(ctx, o);
            }
        }
        this.m_pLayerDrawRot.length = 0;
        ctx.resetTransform();
    }
    update() {
        let inc = (this.m_targetX - this.m_movePos[0]) * 0.25;
        this.m_movePos[0] += inc;
        inc = (this.m_targetY - this.m_movePos[1]) * 0.25;
        this.m_movePos[1] += inc;
        this.m_x = this.m_movePos[0];
        this.m_y = this.m_movePos[1];
        this.m_mapTester.setCam(Point(this.m_x, this.m_y));
    }
    queueLayerDraw(obj) { this.m_pLayerDrawRot.push(obj); }
    addPart(part) {
        part.order = 9999999;
        // insert by layer
        let i = 0;
        for (; i != this.m_mapParts.length; ++i) {
            if (this.m_mapParts[i].layer >= part.layer)
                break;
        }
        for (; i != this.m_mapParts.length; ++i) {
            if (this.m_mapParts[i].layer != part.layer) {
                break;
            }
        }
        this.m_mapParts = array.insertAt(this.m_mapParts, i, part);
        if (i != 0) {
            part.order = this.m_mapParts[i - 1].order;
            for (i = ++i; i != this.m_mapParts.length; ++i) {
                ++(this.m_mapParts[i].order);
            }
        }
        else {
            part.order = 0;
        }
        this.m_mapTester.addObj(part);
    }
    removePart(part) {
        // insert by layer
        this.m_mapParts = array.remove(this.m_mapParts, part);
        this.m_mapTester.removeObj(part);
    }
    partAt(x, y, layer = -1) {
        let list;
        if (this.m_splitParts.length != 0) {
            const [xPart, yPart] = this.pointToSegment(x, y);
            if (xPart < 0 || yPart < 0 || xPart >= this.m_splitWidth || yPart >= this.m_splitWidth)
                return undefined;
            list = this.m_splitParts[xPart + yPart * this.m_splitWidth];
        }
        else {
            list = this.m_mapParts;
        }
        for (const m of list) {
            if (layer != -1)
                if (layer != m.layer)
                    continue;
            assert(m.tex);
            if (x >= m.x && x <= m.x + m.w * m.tex.width &&
                y >= m.y && y <= m.y + m.h * m.tex.height)
                return m;
        }
        return undefined;
    }
    getTile(index) { assert(this.m_pictures); return this.m_pictures.getFrame(index); }
    loadBinary(url, bObjects = false) {
        return __awaiter(this, void 0, void 0, function* () {
            assert(this.m_pictures != undefined);
            const stream = yield fetch(url)
                .then(response => {
                if (response.ok)
                    return response.blob();
                else
                    throw (response.statusText);
            })
                .then(blob => blob.arrayBuffer())
                .then(buf => new Binstream(new DataView(buf)))
                .catch(e => { throw (`Failed to load map ${url}: ${e}`); });
            g_App.m_loadLev = url;
            // free old map data
            this.m_mapParts.length = 0;
            this.m_mapCollide.length = 0;
            this.m_editObjects.length = 0;
            this.m_splitParts.length = 0;
            this.m_splitCollide.length = 0;
            g_App.clearObjects();
            const version = stream.int;
            const partPointerMap = new Map();
            let size = stream.uint;
            for (let i = 0; i < size; i++) {
                const m = new sMapPart(stream.int, stream.int, stream.int, stream.int, stream.int, stream.int, undefined);
                const texNum = stream.int;
                if (texNum > -1)
                    m.tex = this.m_pictures.getFrame(texNum);
                m.order = i;
                const pOldPointer = stream.int;
                partPointerMap.set(pOldPointer, m);
                if (m.w > 0 && m.h > 0) {
                    this.m_mapParts.push(m);
                }
            }
            // Read collision data
            size = stream.uint;
            for (let i = 0; i < size; i++) {
                this.m_mapCollide.push(new sMapCollide(stream.int, stream.int, stream.int, stream.int, stream.int));
            }
            // Read object data
            size = stream.uint;
            for (let i = 0; i < size; i++) {
                const o = new sMapPart(stream.int, stream.int, 0, 0, stream.int, stream.int, undefined);
                if (!bObjects) {
                    this.m_editObjects.push(o);
                }
                else {
                    addObjectType(o.type, o.x, o.y, o.layer);
                }
            }
            this.m_mapTester.loadBinary(stream, partPointerMap);
        });
    }
    affectObject(obj) {
        const mapOver = this.partAt(obj.m_pos.x, obj.m_pos.y);
        if (!mapOver) {
            return undefined;
        }
        let frictionVec = new Point2();
        switch (mapOver.type) {
            case mapType.MAP_DOWN:
                frictionVec.x = 0.0;
                frictionVec.y = 1.0;
                break;
            case mapType.MAP_DOWNRIGHT:
                frictionVec.x = 0.5;
                frictionVec.y = 0.5;
                break;
            case mapType.MAP_RIGHT:
                frictionVec.x = 1.0;
                frictionVec.y = 0.0;
                break;
            case mapType.MAP_UPRIGHT:
                frictionVec.x = 0.5;
                frictionVec.y = -0.5;
                break;
            case mapType.MAP_UP:
                frictionVec.x = 0.0;
                frictionVec.y = -1.0;
                break;
            case mapType.MAP_UPLEFT:
                frictionVec.x = -0.5;
                frictionVec.y = -0.5;
                break;
            case mapType.MAP_LEFT:
                frictionVec.x = -1.0;
                frictionVec.y = 0.0;
                break;
            case mapType.MAP_DOWNLEFT:
                frictionVec.x = -0.5;
                frictionVec.y = 0.5;
                break;
        }
        if (mapOver.type != mapType.MAP_NOFRICTION) {
            obj.m_speed += obj.m_vel.dot(frictionVec) * 0.05;
            if (obj.m_speed > 0) {
                obj.m_speed -= 0.01;
                if (obj.m_speed < 0)
                    obj.m_speed = 0;
            }
            else if (obj.m_speed < 0) {
                obj.m_speed += 0.01;
                if (obj.m_speed > 0)
                    obj.m_speed = 0;
            }
        }
        return mapOver;
    }
    hitTestObject(obj) {
        const [xPart, yPart] = this.pointToSegment(obj.m_pos.x, obj.m_pos.y);
        if (xPart >= this.m_splitWidth || yPart >= this.m_splitHeight || xPart < 0 || yPart < 0)
            return;
        const index = xPart + yPart * this.m_splitWidth;
        for (const c of this.m_splitCollide[index]) {
            if (c.layer != obj.m_layer)
                continue;
            if (obj.gameMapHit(c.sx, c.sy, c.ex, c.ey))
                break;
        }
    }
    getCollideLines(x, y, rad) {
        return this.m_mapCollide;
    }
    mapXToScreen(x, layer) {
        return (x - this.m_x) * (1.0 + (layer * MAP_LAYER_INC));
    }
    mapYToScreen(y, layer) {
        return (y - this.m_y) * (1.0 + (layer * MAP_LAYER_INC));
    }
    static layerScale(val, layer) {
        return val * (1.0 + (layer * MAP_LAYER_INC));
    }
    pointToSegment(x, y) {
        return [(x - this.m_minx) / this.m_segSizeX, (y - this.m_miny) / this.m_segSizeY];
    }
    save() { throw ("Not implemented"); }
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdHMvbWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sWUFBWSxDQUFBO0FBQ25DLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxhQUFhLENBQUE7QUFDcEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBRzFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQUMxQyxPQUFPLEVBQUUsUUFBUSxFQUFhLE1BQU0sZUFBZSxDQUFBO0FBQ25ELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDaEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxhQUFhLENBQUE7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdCQUF3QixDQUFBO0FBRXRELE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQTtBQUU1QixJQUFLLE9BWUo7QUFaRCxXQUFLLE9BQU87SUFFViw2Q0FBWSxDQUFBO0lBQ1osdURBQWEsQ0FBQTtJQUNiLCtDQUFTLENBQUE7SUFDVCxtREFBVyxDQUFBO0lBQ1gseUNBQU0sQ0FBQTtJQUNOLGlEQUFVLENBQUE7SUFDViw2Q0FBUSxDQUFBO0lBQ1IscURBQVksQ0FBQTtJQUNaLDZDQUFRLENBQUE7SUFDUix5REFBYyxDQUFBO0FBQ2hCLENBQUMsRUFaSSxPQUFPLEtBQVAsT0FBTyxRQVlYO0FBQUEsQ0FBQztBQUVGLE1BQU0sV0FBVztJQUVmLFlBQW1CLEVBQVUsRUFBUyxFQUFVLEVBQVMsRUFBVSxFQUFTLEVBQVMsRUFBUyxLQUFhO1FBQXhGLE9BQUUsR0FBRixFQUFFLENBQVE7UUFBUyxPQUFFLEdBQUYsRUFBRSxDQUFRO1FBQVMsT0FBRSxHQUFGLEVBQUUsQ0FBUTtRQUFTLE9BQUUsR0FBRixFQUFFLENBQU87UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFRO0lBRTNHLENBQUM7Q0FDRjtBQUFBLENBQUM7QUFFRixNQUFNLE9BQU8sUUFBUTtJQVFuQixZQUFtQixDQUFTLEVBQVMsQ0FBUyxFQUFTLENBQVMsRUFBUyxDQUFTLEVBQVMsS0FBYSxFQUNyRixJQUFZLEVBQUUsTUFBZ0MsRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBRHpELE1BQUMsR0FBRCxDQUFDLENBQVE7UUFBUyxNQUFDLEdBQUQsQ0FBQyxDQUFRO1FBQVMsTUFBQyxHQUFELENBQUMsQ0FBUTtRQUFTLE1BQUMsR0FBRCxDQUFDLENBQVE7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ3JGLFNBQUksR0FBSixJQUFJLENBQVE7UUFOL0IsV0FBTSxHQUVKLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUE7UUFDOUMsVUFBSyxHQUFHLENBQUMsQ0FBQTtRQUtQLElBQUksTUFBTSxZQUFZLElBQUksRUFBRTtZQUMxQixNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDbEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO1NBQ2hDO2FBQU07WUFDTCxJQUFJLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQTtTQUNsQjtJQUNILENBQUM7SUFFRCxJQUFJLEtBQUssS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNqRSxJQUFJLE1BQU0sS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNuRSxNQUFNLENBQUMsSUFBVSxJQUFJLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDbkUsTUFBTSxDQUFDLElBQVUsSUFBSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBRW5FLGdDQUFnQztJQUNoQyxRQUFRLENBQUMsS0FBZTtRQUN0QixPQUFPLEtBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQy9ELElBQUksQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsRUFDZCxJQUFJLENBQUMsQ0FBQyxHQUFHLEtBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLEdBQUcsS0FBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUNuRixDQUFDO0NBQ0Y7QUFFRCxNQUFNLE9BQU8sSUFBSTtJQUlmLFlBQW9CLEdBQTZCO1FBQTdCLFFBQUcsR0FBSCxHQUFHLENBQTBCO1FBRmpELFVBQUssR0FBRyxLQUFLLENBQUE7UUF3WWIsY0FBUyxHQUFXLENBQUMsQ0FBQTtRQUNyQixjQUFTLEdBQVcsQ0FBQyxDQUFBO1FBQ3JCLFFBQUcsR0FBVyxDQUFDLENBQUE7UUFDZixRQUFHLEdBQVcsQ0FBQyxDQUFBO1FBWVAsb0JBQWUsR0FBRyxFQUFrQixDQUFDO1FBRXJDLGNBQVMsR0FBRyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztRQUcxQiwwREFBMEQ7UUFFbEQsZUFBVSxHQUFHLEVBQWdCLENBQUEsQ0FBRyxRQUFRO1FBQ3hDLGlCQUFZLEdBQUcsRUFBbUIsQ0FBQSxDQUFFLFFBQVE7UUFDNUMsaUJBQVksR0FBRyxFQUF1QixDQUFBLENBQUMscUJBQXFCO1FBQzVELG1CQUFjLEdBQUcsRUFBMEIsQ0FBQyxDQUFDLHFCQUFxQjtRQUVsRSxrQkFBYSxHQUFHLEVBQWdCLENBQUE7UUFDaEMsb0JBQWUsR0FBRyxFQUFjLENBQUM7UUFFakMsZ0JBQVcsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDO1FBRXRDLGNBQWM7UUFDTixXQUFNLEdBQVcsQ0FBQyxPQUFPLENBQUE7UUFDekIsV0FBTSxHQUFXLENBQUMsT0FBTyxDQUFBO1FBQ3pCLGlCQUFZLEdBQVcsQ0FBQyxDQUFBO1FBQ3hCLGtCQUFhLEdBQVcsQ0FBQyxDQUFBO1FBQ2hCLGVBQVUsR0FBRyxHQUFHLEdBQUMsQ0FBQyxDQUFBO1FBQ2xCLGVBQVUsR0FBRyxHQUFHLEdBQUMsQ0FBQyxDQUFBO0lBNWFpQixDQUFDO0lBRS9DLElBQUksQ0FBQyxLQUFjOztZQUN4QixJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUNiLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBQ2IsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7WUFDbkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7WUFDbkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFdEIsV0FBVztZQUVYLGNBQWM7WUFFZCxJQUFJLENBQUMsVUFBVSxHQUFHLE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDakUsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQTtZQUM3QyxJQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO1lBRTdELElBQUksS0FBSyxFQUNUO2dCQUNDLElBQUksQ0FBQyxhQUFhLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7YUFDbEU7UUFDRixDQUFDO0tBQUE7SUFFTyxPQUFPLENBQUMsR0FBNkIsRUFBRSxDQUFhO1FBQzFELElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDeEIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDbkMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDbEIsQ0FBQztJQUVPLGNBQWMsQ0FBQyxHQUE2QjtRQUNsRCxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUE7UUFDcEIsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ2QsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtZQUM3RCxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtZQUNyQixHQUFHLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQTtZQUN2QixHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1NBQy9CO0lBQ0gsQ0FBQztJQUVELElBQUksQ0FBQyxHQUE2QixFQUFFLFVBQWtCLEVBQUUsUUFBZ0I7UUFDdEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRVQsTUFBTSxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUV4QixPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxVQUFVO1lBQ3RHLENBQUMsRUFBRSxDQUFDO1FBRUwsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBRWxCLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUNwRDtZQUNDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0MsSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLFFBQVE7Z0JBQ3RCLE9BQU87WUFFUixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ2QsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUE7WUFFdEIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUN4QixHQUFHLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUE7WUFDekIsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUMxQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQzFDLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksU0FBUyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFBO1lBQzFELEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUV4QywrREFBK0Q7WUFDL0QsSUFBSSxTQUFTLElBQUksQ0FBQyxDQUFDLEtBQUssRUFDeEI7Z0JBQ0MsU0FBUyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7Z0JBRWpCLEdBQUcsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFBO2dCQUV6QixLQUFLLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQ3BDO29CQUNLLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUE7b0JBQ3ZDLElBQUksR0FBRyxDQUFDLE9BQU8sSUFBSSxTQUFTLEVBQzVCO3dCQUNNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO3dCQUMzQixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7cUJBQy9CO2lCQUNEO2FBQ0Q7U0FDRDtRQUVELGtDQUFrQztRQUNsQyxLQUFLLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQ3BDO1lBQ0MsSUFBSSxDQUFDLEVBQUU7Z0JBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUE7YUFDckI7U0FDSDtRQUVELElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQTtRQUM5QixHQUFHLENBQUMsY0FBYyxFQUFFLENBQUE7SUFDdEIsQ0FBQztJQUVELE1BQU07UUFDTCxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUN0RCxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQztRQUN6QixHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDbEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUM7UUFFekIsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUU3QixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNuRCxDQUFDO0lBR0QsY0FBYyxDQUFDLEdBQWUsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFbkUsT0FBTyxDQUFDLElBQWM7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUM7UUFFckIsa0JBQWtCO1FBQ2pCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNWLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUN2QztZQUNDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUs7Z0JBQ3pDLE1BQU07U0FDUDtRQUVELE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUN2QztZQUNDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssRUFDMUM7Z0JBQ0MsTUFBTTthQUNOO1NBQ0Q7UUFFRCxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFM0QsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUNWO1lBQ0MsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFFeEMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUM5QztnQkFDQyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUM3QjtTQUNEO2FBRUQ7WUFDQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztTQUNmO1FBRUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELFVBQVUsQ0FBQyxJQUFjO1FBQ3hCLGtCQUFrQjtRQUVsQixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUNyRCxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsTUFBTSxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUN0QyxJQUFJLElBQWdCLENBQUE7UUFFcEIsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sSUFBSSxDQUFDLEVBQ2pDO1lBQ0MsTUFBTSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUVqRCxJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLFlBQVk7Z0JBQ3JGLE9BQU8sU0FBUyxDQUFDO1lBRWhCLElBQUksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO1NBQzdEO2FBRUQ7WUFDRyxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQTtTQUN4QjtRQUVELEtBQUssTUFBTSxDQUFDLElBQUksSUFBSSxFQUNwQjtZQUNDLElBQUksS0FBSyxJQUFJLENBQUMsQ0FBQztnQkFDZCxJQUFJLEtBQUssSUFBSSxDQUFDLENBQUMsS0FBSztvQkFDbkIsU0FBUztZQUVULE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDZixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLO2dCQUMzQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTTtnQkFDekMsT0FBTyxDQUFDLENBQUM7U0FDVjtRQUVELE9BQU8sU0FBUyxDQUFDO0lBQ2xCLENBQUM7SUFFRCxPQUFPLENBQUMsS0FBYSxJQUFlLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVoRyxVQUFVLENBQUMsR0FBVyxFQUFFLFFBQVEsR0FBRyxLQUFLOztZQUM1QyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxTQUFTLENBQUMsQ0FBQTtZQUVyQyxNQUFNLE1BQU0sR0FDVCxNQUFNLEtBQUssQ0FBQyxHQUFHLENBQUM7aUJBQ2IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNmLElBQUksUUFBUSxDQUFDLEVBQUU7b0JBQ2IsT0FBTyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUE7O29CQUV0QixNQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1lBQzlCLENBQUMsQ0FBQztpQkFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksU0FBUyxDQUFDLElBQUksUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7aUJBQzdDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLE1BQUssQ0FBQyxzQkFBc0IsR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUU5RCxLQUFNLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztZQUV2QixvQkFBb0I7WUFDcEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO1lBQzFCLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQTtZQUM1QixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7WUFDN0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO1lBQzVCLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQTtZQUM5QixLQUFNLENBQUMsWUFBWSxFQUFFLENBQUE7WUFFckIsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQTtZQUUxQixNQUFNLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBb0IsQ0FBQTtZQUNsRCxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFBO1lBRXRCLEtBQUssSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQzNCO2dCQUNDLE1BQU0sQ0FBQyxHQUFHLElBQUksUUFBUSxDQUNsQixNQUFNLENBQUMsR0FBRyxFQUNWLE1BQU0sQ0FBQyxHQUFHLEVBQ1YsTUFBTSxDQUFDLEdBQUcsRUFDVixNQUFNLENBQUMsR0FBRyxFQUNWLE1BQU0sQ0FBQyxHQUFHLEVBQ1YsTUFBTSxDQUFDLEdBQUcsRUFDVixTQUFTLENBQ1YsQ0FBQTtnQkFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFBO2dCQUN6QixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7b0JBQ2QsQ0FBQyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFFMUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7Z0JBRVosTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQztnQkFDN0IsY0FBYyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUE7Z0JBRXBDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQ3RCO29CQUNDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUN4QjthQUNEO1lBRUQsc0JBQXNCO1lBRXRCLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFBO1lBRWxCLEtBQUssSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQzNCO2dCQUNDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7YUFDcEc7WUFFRCxtQkFBbUI7WUFFbkIsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUE7WUFFbEIsS0FBSyxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLEVBQUUsRUFDM0I7Z0JBQ0MsTUFBTSxDQUFDLEdBQUcsSUFBSSxRQUFRLENBQ2xCLE1BQU0sQ0FBQyxHQUFHLEVBQ1YsTUFBTSxDQUFDLEdBQUcsRUFDVixDQUFDLEVBQ0QsQ0FBQyxFQUNELE1BQU0sQ0FBQyxHQUFHLEVBQ1YsTUFBTSxDQUFDLEdBQUcsRUFDVixTQUFTLENBQ1YsQ0FBQztnQkFFSixJQUFJLENBQUMsUUFBUSxFQUNiO29CQUNDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUMzQjtxQkFFRDtvQkFDQyxhQUFhLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUN6QzthQUNEO1lBRUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFBO1FBQ3BELENBQUM7S0FBQTtJQUVELFlBQVksQ0FBQyxHQUFlO1FBQzNCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV0RCxJQUFJLENBQUMsT0FBTyxFQUNaO1lBQ0MsT0FBTyxTQUFTLENBQUM7U0FDakI7UUFFRCxJQUFJLFdBQVcsR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO1FBRS9CLFFBQVEsT0FBTyxDQUFDLElBQUksRUFDcEI7WUFDRSxLQUFLLE9BQU8sQ0FBQyxRQUFRO2dCQUNwQixXQUFXLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztnQkFDcEIsV0FBVyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7Z0JBQ3BCLE1BQU07WUFDUCxLQUFLLE9BQU8sQ0FBQyxhQUFhO2dCQUN6QixXQUFXLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztnQkFDcEIsV0FBVyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7Z0JBQ3BCLE1BQU07WUFDUCxLQUFLLE9BQU8sQ0FBQyxTQUFTO2dCQUNyQixXQUFXLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztnQkFDcEIsV0FBVyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7Z0JBQ3BCLE1BQU07WUFDUCxLQUFLLE9BQU8sQ0FBQyxXQUFXO2dCQUN2QixXQUFXLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztnQkFDcEIsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztnQkFDckIsTUFBTTtZQUNQLEtBQUssT0FBTyxDQUFDLE1BQU07Z0JBQ2xCLFdBQVcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO2dCQUNwQixXQUFXLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO2dCQUNyQixNQUFNO1lBQ1AsS0FBSyxPQUFPLENBQUMsVUFBVTtnQkFDdEIsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztnQkFDckIsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztnQkFDckIsTUFBTTtZQUNQLEtBQUssT0FBTyxDQUFDLFFBQVE7Z0JBQ3BCLFdBQVcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7Z0JBQ3JCLFdBQVcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO2dCQUNwQixNQUFNO1lBQ1AsS0FBSyxPQUFPLENBQUMsWUFBWTtnQkFDeEIsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztnQkFDckIsV0FBVyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7Z0JBQ3BCLE1BQU07U0FDUjtRQUVELElBQUksT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsY0FBYyxFQUMxQztZQUNDLEdBQUcsQ0FBQyxPQUFPLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBRWpELElBQUksR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLEVBQ25CO2dCQUNDLEdBQUcsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDO2dCQUNwQixJQUFJLEdBQUcsQ0FBQyxPQUFPLEdBQUcsQ0FBQztvQkFDbEIsR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7YUFDakI7aUJBQ0ksSUFBSSxHQUFHLENBQUMsT0FBTyxHQUFHLENBQUMsRUFDeEI7Z0JBQ0MsR0FBRyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUM7Z0JBQ3BCLElBQUksR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDO29CQUNsQixHQUFHLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQzthQUNqQjtTQUNEO1FBRUQsT0FBTyxPQUFPLENBQUM7SUFDaEIsQ0FBQztJQUdELGFBQWEsQ0FBQyxHQUFlO1FBQzVCLE1BQU0sQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXJFLElBQUksS0FBSyxJQUFJLElBQUksQ0FBQyxZQUFZLElBQUksS0FBSyxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksS0FBSyxHQUFHLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQztZQUN0RixPQUFPO1FBRVIsTUFBTSxLQUFLLEdBQUcsS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBRWhELEtBQUssTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsRUFDMUM7WUFDQyxJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLE9BQU87Z0JBQ3pCLFNBQVM7WUFFVixJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQztnQkFDekMsTUFBTTtTQUNQO0lBQ0YsQ0FBQztJQUVELGVBQWUsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLEdBQVc7UUFDaEQsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzFCLENBQUM7SUFFRCxZQUFZLENBQUMsQ0FBUyxFQUFFLEtBQWE7UUFDbkMsT0FBTyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQTtJQUN6RCxDQUFDO0lBRUQsWUFBWSxDQUFDLENBQVMsRUFBRSxLQUFhO1FBQ25DLE9BQU8sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUE7SUFDekQsQ0FBQztJQUVELE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBVyxFQUFFLEtBQWE7UUFDMUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQTtJQUM5QyxDQUFDO0lBVU8sY0FBYyxDQUFDLENBQVMsRUFBRSxDQUFTO1FBRTFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQ2xGLENBQUM7SUFTTyxJQUFJLEtBQUssTUFBSyxDQUFDLGlCQUFpQixDQUFDLENBQUEsQ0FBQyxDQUFDO0NBb0I1QztBQUFBLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBhcnJheSBmcm9tIFwiLi9hcnJheS5qc1wiXG5pbXBvcnQgeyBhc3NlcnQgfSBmcm9tIFwiLi9hc3NlcnQuanNcIlxuaW1wb3J0IHsgQmluc3RyZWFtIH0gZnJvbSBcIi4vYmluc3RyZWFtLmpzXCJcbmltcG9ydCB7IHNSZWMgfSBmcm9tIFwiLi9idWNrZXQuanNcIlxuaW1wb3J0IHsgR2FtZU9iamVjdCB9IGZyb20gXCIuL2dhbWVvYmplY3QuanNcIlxuaW1wb3J0IHsgTWFwVGVzdGVyIH0gZnJvbSBcIi4vbWFwdGVzdGVyLmpzXCJcbmltcG9ydCB7IFBpY3R1cmVzLCBGcmFtZUluZm8gfSBmcm9tIFwiLi9waWN0dXJlcy5qc1wiXG5pbXBvcnQgeyBnX0FwcCB9IGZyb20gXCIuL2FwcC5qc1wiXG5pbXBvcnQgeyBQb2ludCwgUG9pbnQyIH0gZnJvbSBcIi4vcG9pbnQyLmpzXCJcbmltcG9ydCB7IGFkZE9iamVjdFR5cGUgfSBmcm9tIFwiLi9vYmplY3RzL3NlcmlhbGl6ZS5qc1wiXG5cbmNvbnN0IE1BUF9MQVlFUl9JTkMgPSAwLjAxMjVcblxuZW51bSBtYXBUeXBlXG57XG4gIE1BUF9ET1dOID0gMCxcbiAgTUFQX0RPV05SSUdIVCxcbiAgTUFQX1JJR0hULFxuICBNQVBfVVBSSUdIVCxcbiAgTUFQX1VQLFxuICBNQVBfVVBMRUZULFxuICBNQVBfTEVGVCxcbiAgTUFQX0RPV05MRUZULFxuICBNQVBfRkxBVCxcbiAgTUFQX05PRlJJQ1RJT05cbn07XG5cbmNsYXNzIHNNYXBDb2xsaWRlXG57XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBzeDogbnVtYmVyLCBwdWJsaWMgc3k6IG51bWJlciwgcHVibGljIGV4OiBudW1iZXIsIHB1YmxpYyBleTpudW1iZXIsIHB1YmxpYyBsYXllcjogbnVtYmVyKVxuICB7XG4gIH1cbn07XG5cbmV4cG9ydCBjbGFzcyBzTWFwUGFydFxue1xuICB0ZXg6IEZyYW1lSW5mb3x1bmRlZmluZWRcbiAgY29sUmVjOiBbc1JlYzxzTWFwUGFydD58dW5kZWZpbmVkLCBzUmVjPHNNYXBQYXJ0Pnx1bmRlZmluZWQsXG4gICAgICAgICAgIHNSZWM8c01hcFBhcnQ+fHVuZGVmaW5lZCwgc1JlYzxzTWFwUGFydD58dW5kZWZpbmVkXSA9XG4gICAgW3VuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZF1cbiAgb3JkZXIgPSAwXG5cbiAgY29uc3RydWN0b3IocHVibGljIHg6IG51bWJlciwgcHVibGljIHk6IG51bWJlciwgcHVibGljIHc6IG51bWJlciwgcHVibGljIGg6IG51bWJlciwgcHVibGljIGxheWVyOiBudW1iZXIsXG4gICAgICAgICAgICAgIHB1YmxpYyB0eXBlOiBudW1iZXIsIHRleG1hcDogRnJhbWVJbmZvfENNYXB8dW5kZWZpbmVkLCBwdGV4ID0gLTEpXG4gIHtcbiAgICBpZiAodGV4bWFwIGluc3RhbmNlb2YgQ01hcCkge1xuICAgICAgYXNzZXJ0KHB0ZXggIT0gLTEpXG4gICAgICB0aGlzLnRleCA9IHRleG1hcC5nZXRUaWxlKHB0ZXgpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudGV4ID0gdGV4bWFwXG4gICAgfVxuICB9XG5cbiAgZ2V0IHdpZHRoKCkgeyBhc3NlcnQodGhpcy50ZXgpOyByZXR1cm4gdGhpcy53ICogdGhpcy50ZXgud2lkdGg7IH1cbiAgZ2V0IGhlaWdodCgpIHsgYXNzZXJ0KHRoaXMudGV4KTsgcmV0dXJuIHRoaXMuaCAqIHRoaXMudGV4LmhlaWdodDsgfVxuICB0cmFuc1gocE1hcDogQ01hcCkgeyByZXR1cm4gcE1hcC5tYXBYVG9TY3JlZW4odGhpcy54LCB0aGlzLmxheWVyKSB9XG4gIHRyYW5zWShwTWFwOiBDTWFwKSB7IHJldHVybiBwTWFwLm1hcFlUb1NjcmVlbih0aGlzLnksIHRoaXMubGF5ZXIpIH1cblxuICAvLyB0ZXN0IGFnYWluc3QgdGhlIG1hcCdzIGNhbWVyYVxuICB0ZXN0QkJveChwUGFydDogc01hcFBhcnQpIHtcbiAgICByZXR1cm4gZ19BcHAhLmJveEJveChwUGFydC54LCBwUGFydC55LCBwUGFydC54ICsgcFBhcnQud2lkdGgsIHBQYXJ0LnkgKyBwUGFydC5oZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54LCB0aGlzLnksIFxuICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueCArIGdfQXBwIS5jYW52YXMud2lkdGgsIHRoaXMueSArIGdfQXBwIS5jYW52YXMuaGVpZ2h0KVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDTWFwXG57XG4gIGRlYnVnID0gZmFsc2VcbiAgXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHt9XG4gIFxuICBhc3luYyBpbml0KGJFZGl0OiBib29sZWFuKSB7XG5cdCAgdGhpcy5tX3ggPSAwO1xuXHQgIHRoaXMubV95ID0gMDtcblx0ICB0aGlzLm1fdGFyZ2V0WCA9IDA7XG5cdCAgdGhpcy5tX3RhcmdldFkgPSAwO1xuXHQgIHRoaXMubV9tb3ZlUG9zWzBdID0gMDtcblx0ICB0aGlzLm1fbW92ZVBvc1sxXSA9IDA7XG5cblx0ICAvLyBJbml0IEdGWFxuXG5cdCAgLy8gVGlsZSBjb29yZHNcblxuXHQgIHRoaXMubV9waWN0dXJlcyA9IGF3YWl0IFBpY3R1cmVzLmxvYWQoXCJtZWRpYS90aWxlcy50eHRcIiwgdGhpcy5jdHgpXG4gICAgdGhpcy5tX2VkaXRUaWxlT3JkZXIgPSB0aGlzLm1fcGljdHVyZXMub3JkZXJcblx0ICB0aGlzLm1fdGlsZXR5cGVzID0gYXdhaXQgUGljdHVyZXMubG9hZChcIm1lZGlhL3RpbGV0eXBlcy50eHRcIilcblxuXHQgIGlmIChiRWRpdClcblx0ICB7XG5cdFx0ICB0aGlzLm1fb2JqZWN0dHlwZXMgPSBhd2FpdCBQaWN0dXJlcy5sb2FkKFwibWVkaWEvb2JqZWN0dHlwZXMudHh0XCIpO1xuXHQgIH1cbiAgfVxuXG4gIHByaXZhdGUgZHJhd09iaihjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgbzogR2FtZU9iamVjdCkge1xuICAgIHRoaXMucmVzZXRUcmFuc2Zvcm0oY3R4KVxuICAgIGN0eC50cmFuc2xhdGUoLXRoaXMubV94LCAtdGhpcy5tX3kpXG4gICAgby5kcmF3KHRoaXMuY3R4KVxuICB9XG5cbiAgcHJpdmF0ZSByZXNldFRyYW5zZm9ybShjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkge1xuICAgIGN0eC5yZXNldFRyYW5zZm9ybSgpXG4gICAgaWYgKHRoaXMuZGVidWcpIHtcbiAgICAgIGN0eC50cmFuc2xhdGUoKDY0MCAtIDY0MCAqIDAuMjUpIC8gMiwgKDQ4MCAtIDQ4MCAqIDAuMjUpIC8gMilcbiAgICAgIGN0eC5zY2FsZSgwLjI1LCAwLjI1KVxuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJyZWRcIlxuICAgICAgY3R4LnN0cm9rZVJlY3QoMCwgMCwgNjQwLCA0ODApXG4gICAgfVxuICB9XG4gIFxuICBkcmF3KGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBzdGFydExheWVyOiBudW1iZXIsIGVuZExheWVyOiBudW1iZXIpIHtcbiAgICBsZXQgaSA9IDBcblx0ICBsZXQgcSA9IDA7XG5cbiAgICBhc3NlcnQoc3RhcnRMYXllciA+PSAwKVxuICAgIFxuXHQgIHdoaWxlIChxICE9IHRoaXMubV9tYXBUZXN0ZXIuZ2V0Q29sTGlzdCgpLmxlbmd0aCAmJiB0aGlzLm1fbWFwVGVzdGVyLmdldENvbExpc3QoKVtxXS5sYXllciA8IHN0YXJ0TGF5ZXIpXG5cdFx0ICBxKys7XG5cblx0ICBsZXQgbGFzdExheWVyID0gMDtcblxuXHQgIGZvciAoOyBxIDwgdGhpcy5tX21hcFRlc3Rlci5nZXRDb2xMaXN0KCkubGVuZ3RoOyBxKyspXG5cdCAge1xuXHRcdCAgY29uc3QgbSA9IHRoaXMubV9tYXBUZXN0ZXIuZ2V0Q29sTGlzdCgpW3FdO1xuXHRcdCAgaWYgKG0ubGF5ZXIgPT0gZW5kTGF5ZXIpXG5cdFx0XHQgIHJldHVybjtcblx0XHQgIFxuXHRcdCAgY29uc3QgZiA9IG0udGV4O1xuICAgICAgYXNzZXJ0KGYgJiYgZi5wYXR0ZXJuKVxuXG4gICAgICB0aGlzLnJlc2V0VHJhbnNmb3JtKGN0eClcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBmLnBhdHRlcm5cbiAgICAgIGNvbnN0IHd4ID0gdGhpcy5tYXBYVG9TY3JlZW4obS54LCBtLmxheWVyKVxuICAgICAgY29uc3Qgd3kgPSB0aGlzLm1hcFlUb1NjcmVlbihtLnksIG0ubGF5ZXIpXG4gICAgICBmLnBhdHRlcm4uc2V0VHJhbnNmb3JtKG5ldyBET01NYXRyaXgoKS50cmFuc2xhdGUod3gsIHd5KSlcblx0ICAgIGN0eC5maWxsUmVjdCh3eCwgd3ksIG0ud2lkdGgsIG0uaGVpZ2h0KVxuXG5cdFx0ICAvLyBOb3cgZHJhdyBvYmplY3RzIHRoYXQgYXJlICdsYXllcmVkJyBpZiB0aGUgbGF5ZXIgaGFzIGNoYW5nZWRcblx0XHQgIGlmIChsYXN0TGF5ZXIgIT0gbS5sYXllcilcblx0XHQgIHtcblx0XHRcdCAgbGFzdExheWVyID0gbS5sYXllcjtcblxuICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJub25lXCJcbiAgICAgICAgXG5cdFx0XHQgIGZvciAoY29uc3QgaSBpbiB0aGlzLm1fcExheWVyRHJhd1JvdClcblx0XHRcdCAge1xuICAgICAgICAgIGNvbnN0IG9iaiA9IHRoaXMubV9wTGF5ZXJEcmF3Um90W2ldXG5cdFx0XHRcdCAgaWYgKG9iai5tX2xheWVyID09IGxhc3RMYXllcilcblx0XHRcdFx0ICB7XG4gICAgICAgICAgICB0aGlzLmRyYXdPYmooY3R4LCBvYmopXG5cdFx0XHRcdFx0ICBkZWxldGUgdGhpcy5tX3BMYXllckRyYXdSb3RbaV07XG5cdFx0XHRcdCAgfVxuXHRcdFx0ICB9XG5cdFx0ICB9XG5cdCAgfVxuXG5cdCAgLy8gRHJhdyBhbnkgbGVmdG92ZXIgbGF5ZXIgb2JqZWN0c1xuXHQgIGZvciAoY29uc3QgbyBvZiB0aGlzLm1fcExheWVyRHJhd1JvdClcblx0ICB7XG5cdFx0ICBpZiAobykge1xuICAgICAgICB0aGlzLmRyYXdPYmooY3R4LCBvKVxuICAgICAgfVxuXHQgIH1cbiAgICBcblx0ICB0aGlzLm1fcExheWVyRHJhd1JvdC5sZW5ndGggPSAwXG4gICAgY3R4LnJlc2V0VHJhbnNmb3JtKClcbiAgfVxuXG4gIHVwZGF0ZSgpIHtcblx0ICBsZXQgaW5jID0gKHRoaXMubV90YXJnZXRYIC0gdGhpcy5tX21vdmVQb3NbMF0pICogMC4yNTtcblx0ICB0aGlzLm1fbW92ZVBvc1swXSArPSBpbmM7XG5cdCAgaW5jID0gKHRoaXMubV90YXJnZXRZIC0gdGhpcy5tX21vdmVQb3NbMV0pICogMC4yNTtcblx0ICB0aGlzLm1fbW92ZVBvc1sxXSArPSBpbmM7XG5cblx0ICB0aGlzLm1feCA9IHRoaXMubV9tb3ZlUG9zWzBdO1xuXHQgIHRoaXMubV95ID0gdGhpcy5tX21vdmVQb3NbMV07XG5cblx0ICB0aGlzLm1fbWFwVGVzdGVyLnNldENhbShQb2ludCh0aGlzLm1feCwgdGhpcy5tX3kpKVxuICB9XG5cblxuICBxdWV1ZUxheWVyRHJhdyhvYmo6IEdhbWVPYmplY3QpIHsgdGhpcy5tX3BMYXllckRyYXdSb3QucHVzaChvYmopOyB9XG5cbiAgYWRkUGFydChwYXJ0OiBzTWFwUGFydCkge1xuXHQgIHBhcnQub3JkZXIgPSA5OTk5OTk5O1xuXG5cdCAgLy8gaW5zZXJ0IGJ5IGxheWVyXG4gICAgbGV0IGkgPSAwXG5cdCAgZm9yICg7IGkgIT0gdGhpcy5tX21hcFBhcnRzLmxlbmd0aDsgKytpKVxuXHQgIHtcblx0XHQgIGlmICh0aGlzLm1fbWFwUGFydHNbaV0ubGF5ZXIgPj0gcGFydC5sYXllcilcblx0XHRcdCAgYnJlYWs7XG5cdCAgfVxuXG5cdCAgZm9yICg7IGkgIT0gdGhpcy5tX21hcFBhcnRzLmxlbmd0aDsgKytpKVxuXHQgIHtcblx0XHQgIGlmICh0aGlzLm1fbWFwUGFydHNbaV0ubGF5ZXIgIT0gcGFydC5sYXllcilcblx0XHQgIHtcblx0XHRcdCAgYnJlYWs7XG5cdFx0ICB9XG5cdCAgfVxuXG5cdCAgdGhpcy5tX21hcFBhcnRzID0gYXJyYXkuaW5zZXJ0QXQodGhpcy5tX21hcFBhcnRzLCBpLCBwYXJ0KTtcblxuXHQgIGlmIChpICE9IDApXG5cdCAge1xuXHRcdCAgcGFydC5vcmRlciA9IHRoaXMubV9tYXBQYXJ0c1tpLTFdLm9yZGVyO1xuXG5cdFx0ICBmb3IgKGkgPSArK2k7IGkgIT0gdGhpcy5tX21hcFBhcnRzLmxlbmd0aDsgKytpKVxuXHRcdCAge1xuXHRcdFx0ICArKyh0aGlzLm1fbWFwUGFydHNbaV0ub3JkZXIpO1xuXHRcdCAgfVxuXHQgIH1cblx0ICBlbHNlXG5cdCAge1xuXHRcdCAgcGFydC5vcmRlciA9IDA7XG5cdCAgfVxuXG5cdCAgdGhpcy5tX21hcFRlc3Rlci5hZGRPYmoocGFydCk7XG4gIH1cblxuICByZW1vdmVQYXJ0KHBhcnQ6IHNNYXBQYXJ0KSB7XG5cdCAgLy8gaW5zZXJ0IGJ5IGxheWVyXG5cblx0ICB0aGlzLm1fbWFwUGFydHMgPSBhcnJheS5yZW1vdmUodGhpcy5tX21hcFBhcnRzLCBwYXJ0KVxuXHQgIHRoaXMubV9tYXBUZXN0ZXIucmVtb3ZlT2JqKHBhcnQpO1xuICB9XG5cbiAgcGFydEF0KHg6IG51bWJlciwgeTogbnVtYmVyLCBsYXllciA9IC0xKTogc01hcFBhcnR8dW5kZWZpbmVkIHtcblx0ICBsZXQgbGlzdDogc01hcFBhcnRbXVxuXG5cdCAgaWYgKHRoaXMubV9zcGxpdFBhcnRzLmxlbmd0aCAhPSAwKVxuXHQgIHtcblx0XHQgIGNvbnN0IFt4UGFydCwgeVBhcnRdID0gdGhpcy5wb2ludFRvU2VnbWVudCh4LCB5KTtcblxuXHRcdCAgaWYgKHhQYXJ0IDwgMCB8fCB5UGFydCA8IDAgfHwgeFBhcnQgPj0gdGhpcy5tX3NwbGl0V2lkdGggfHwgeVBhcnQgPj0gdGhpcy5tX3NwbGl0V2lkdGgpXG5cdFx0XHQgIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgICAgIGxpc3QgPSB0aGlzLm1fc3BsaXRQYXJ0c1t4UGFydCArIHlQYXJ0ICogdGhpcy5tX3NwbGl0V2lkdGhdXG5cdCAgfVxuXHQgIGVsc2Vcblx0ICB7XG4gICAgICBsaXN0ID0gdGhpcy5tX21hcFBhcnRzXG5cdCAgfVxuXG5cdCAgZm9yIChjb25zdCBtIG9mIGxpc3QpXG5cdCAge1xuXHRcdCAgaWYgKGxheWVyICE9IC0xKVxuXHRcdFx0ICBpZiAobGF5ZXIgIT0gbS5sYXllcilcblx0XHRcdFx0ICBjb250aW51ZTtcblxuICAgICAgYXNzZXJ0KG0udGV4KVxuXHRcdCAgaWYgKHggPj0gbS54ICYmIHggPD0gbS54ICsgbS53ICogbS50ZXgud2lkdGggJiZcblx0XHRcdCAgeSA+PSBtLnkgJiYgeSA8PSBtLnkgKyBtLmggKiBtLnRleC5oZWlnaHQpXG5cdFx0XHQgIHJldHVybiBtO1xuXHQgIH1cblxuXHQgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXRUaWxlKGluZGV4OiBudW1iZXIpOiBGcmFtZUluZm8geyBhc3NlcnQodGhpcy5tX3BpY3R1cmVzKTsgcmV0dXJuIHRoaXMubV9waWN0dXJlcy5nZXRGcmFtZShpbmRleCk7IH1cblxuICBhc3luYyBsb2FkQmluYXJ5KHVybDogc3RyaW5nLCBiT2JqZWN0cyA9IGZhbHNlKSB7XG4gICAgYXNzZXJ0KHRoaXMubV9waWN0dXJlcyAhPSB1bmRlZmluZWQpXG4gICAgXG5cdCAgY29uc3Qgc3RyZWFtID1cbiAgICAgIGF3YWl0IGZldGNoKHVybClcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgIGlmIChyZXNwb25zZS5vaylcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5ibG9iKClcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aHJvdyhyZXNwb25zZS5zdGF0dXNUZXh0KVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihibG9iID0+IGJsb2IuYXJyYXlCdWZmZXIoKSlcbiAgICAgICAgLnRoZW4oYnVmID0+IG5ldyBCaW5zdHJlYW0obmV3IERhdGFWaWV3KGJ1ZikpKVxuICAgICAgICAuY2F0Y2goZSA9PiB7IHRocm93KGBGYWlsZWQgdG8gbG9hZCBtYXAgJHt1cmx9OiAke2V9YCkgfSlcblxuXHQgIGdfQXBwIS5tX2xvYWRMZXYgPSB1cmw7XG5cblx0ICAvLyBmcmVlIG9sZCBtYXAgZGF0YVxuXHQgIHRoaXMubV9tYXBQYXJ0cy5sZW5ndGggPSAwXG5cdCAgdGhpcy5tX21hcENvbGxpZGUubGVuZ3RoID0gMFxuXHQgIHRoaXMubV9lZGl0T2JqZWN0cy5sZW5ndGggPSAwXG5cdCAgdGhpcy5tX3NwbGl0UGFydHMubGVuZ3RoID0gMFxuXHQgIHRoaXMubV9zcGxpdENvbGxpZGUubGVuZ3RoID0gMFxuXHQgIGdfQXBwIS5jbGVhck9iamVjdHMoKVxuXG5cdCAgY29uc3QgdmVyc2lvbiA9IHN0cmVhbS5pbnRcblxuXHQgIGNvbnN0IHBhcnRQb2ludGVyTWFwID0gbmV3IE1hcDxudW1iZXIsIHNNYXBQYXJ0PigpXG5cdCAgbGV0IHNpemUgPSBzdHJlYW0udWludFxuXG5cdCAgZm9yIChsZXQgaT0wOyBpIDwgc2l6ZTsgaSsrKVxuXHQgIHtcblx0XHQgIGNvbnN0IG0gPSBuZXcgc01hcFBhcnQoXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHVuZGVmaW5lZFxuICAgICAgKVxuXG5cdFx0ICBjb25zdCB0ZXhOdW0gPSBzdHJlYW0uaW50XG5cdFx0ICBpZiAodGV4TnVtID4gLTEpXG5cdFx0XHQgIG0udGV4ID0gdGhpcy5tX3BpY3R1cmVzLmdldEZyYW1lKHRleE51bSk7XG5cblx0XHQgIG0ub3JkZXIgPSBpO1xuXG5cdFx0ICBjb25zdCBwT2xkUG9pbnRlciA9IHN0cmVhbS5pbnQ7XG4gICAgICBwYXJ0UG9pbnRlck1hcC5zZXQocE9sZFBvaW50ZXIsIG0pXG5cblx0XHQgIGlmIChtLncgPiAwICYmIG0uaCA+IDApXG5cdFx0ICB7XG5cdFx0XHQgIHRoaXMubV9tYXBQYXJ0cy5wdXNoKG0pO1xuXHRcdCAgfVxuXHQgIH1cblxuXHQgIC8vIFJlYWQgY29sbGlzaW9uIGRhdGFcblxuXHQgIHNpemUgPSBzdHJlYW0udWludFxuXHQgIFxuXHQgIGZvciAobGV0IGk9MDsgaSA8IHNpemU7IGkrKylcblx0ICB7XG5cdFx0ICB0aGlzLm1fbWFwQ29sbGlkZS5wdXNoKG5ldyBzTWFwQ29sbGlkZShzdHJlYW0uaW50LCBzdHJlYW0uaW50LCBzdHJlYW0uaW50LCBzdHJlYW0uaW50LCBzdHJlYW0uaW50KSk7XG5cdCAgfVxuXHQgIFxuXHQgIC8vIFJlYWQgb2JqZWN0IGRhdGFcblxuXHQgIHNpemUgPSBzdHJlYW0udWludFxuXG5cdCAgZm9yIChsZXQgaT0wOyBpIDwgc2l6ZTsgaSsrKVxuXHQgIHtcblx0XHQgIGNvbnN0IG8gPSBuZXcgc01hcFBhcnQoXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHN0cmVhbS5pbnQsXG4gICAgICAgIHVuZGVmaW5lZFxuICAgICAgKTtcblxuXHRcdCAgaWYgKCFiT2JqZWN0cylcblx0XHQgIHtcblx0XHRcdCAgdGhpcy5tX2VkaXRPYmplY3RzLnB1c2gobyk7XG5cdFx0ICB9XG5cdFx0ICBlbHNlXG5cdFx0ICB7XG5cdFx0XHQgIGFkZE9iamVjdFR5cGUoby50eXBlLCBvLngsIG8ueSwgby5sYXllcik7XG5cdFx0ICB9XG5cdCAgfVxuXG5cdCAgdGhpcy5tX21hcFRlc3Rlci5sb2FkQmluYXJ5KHN0cmVhbSwgcGFydFBvaW50ZXJNYXApXG4gIH1cblxuICBhZmZlY3RPYmplY3Qob2JqOiBHYW1lT2JqZWN0KTogc01hcFBhcnR8dW5kZWZpbmVkIHtcblx0ICBjb25zdCBtYXBPdmVyID0gdGhpcy5wYXJ0QXQob2JqLm1fcG9zLngsIG9iai5tX3Bvcy55KTtcblxuXHQgIGlmICghbWFwT3Zlcilcblx0ICB7XG5cdFx0ICByZXR1cm4gdW5kZWZpbmVkO1xuXHQgIH1cblxuXHQgIGxldCBmcmljdGlvblZlYyA9IG5ldyBQb2ludDIoKTtcblxuXHQgIHN3aXRjaCAobWFwT3Zlci50eXBlKVxuXHQgIHtcblx0ICAgIGNhc2UgbWFwVHlwZS5NQVBfRE9XTjpcblx0XHQgICAgZnJpY3Rpb25WZWMueCA9IDAuMDtcblx0XHQgICAgZnJpY3Rpb25WZWMueSA9IDEuMDtcblx0XHQgICAgYnJlYWs7XG5cdCAgICBjYXNlIG1hcFR5cGUuTUFQX0RPV05SSUdIVDpcblx0XHQgICAgZnJpY3Rpb25WZWMueCA9IDAuNTtcblx0XHQgICAgZnJpY3Rpb25WZWMueSA9IDAuNTtcblx0XHQgICAgYnJlYWs7XG5cdCAgICBjYXNlIG1hcFR5cGUuTUFQX1JJR0hUOlxuXHRcdCAgICBmcmljdGlvblZlYy54ID0gMS4wO1xuXHRcdCAgICBmcmljdGlvblZlYy55ID0gMC4wO1xuXHRcdCAgICBicmVhaztcblx0ICAgIGNhc2UgbWFwVHlwZS5NQVBfVVBSSUdIVDpcblx0XHQgICAgZnJpY3Rpb25WZWMueCA9IDAuNTtcblx0XHQgICAgZnJpY3Rpb25WZWMueSA9IC0wLjU7XG5cdFx0ICAgIGJyZWFrO1xuXHQgICAgY2FzZSBtYXBUeXBlLk1BUF9VUDpcblx0XHQgICAgZnJpY3Rpb25WZWMueCA9IDAuMDtcblx0XHQgICAgZnJpY3Rpb25WZWMueSA9IC0xLjA7XG5cdFx0ICAgIGJyZWFrO1xuXHQgICAgY2FzZSBtYXBUeXBlLk1BUF9VUExFRlQ6XG5cdFx0ICAgIGZyaWN0aW9uVmVjLnggPSAtMC41O1xuXHRcdCAgICBmcmljdGlvblZlYy55ID0gLTAuNTtcblx0XHQgICAgYnJlYWs7XG5cdCAgICBjYXNlIG1hcFR5cGUuTUFQX0xFRlQ6XG5cdFx0ICAgIGZyaWN0aW9uVmVjLnggPSAtMS4wO1xuXHRcdCAgICBmcmljdGlvblZlYy55ID0gMC4wO1xuXHRcdCAgICBicmVhaztcblx0ICAgIGNhc2UgbWFwVHlwZS5NQVBfRE9XTkxFRlQ6XG5cdFx0ICAgIGZyaWN0aW9uVmVjLnggPSAtMC41O1xuXHRcdCAgICBmcmljdGlvblZlYy55ID0gMC41O1xuXHRcdCAgICBicmVhaztcblx0ICB9XG5cblx0ICBpZiAobWFwT3Zlci50eXBlICE9IG1hcFR5cGUuTUFQX05PRlJJQ1RJT04pXG5cdCAge1xuXHRcdCAgb2JqLm1fc3BlZWQgKz0gb2JqLm1fdmVsLmRvdChmcmljdGlvblZlYykgKiAwLjA1O1xuXG5cdFx0ICBpZiAob2JqLm1fc3BlZWQgPiAwKVxuXHRcdCAge1xuXHRcdFx0ICBvYmoubV9zcGVlZCAtPSAwLjAxO1xuXHRcdFx0ICBpZiAob2JqLm1fc3BlZWQgPCAwKVxuXHRcdFx0XHQgIG9iai5tX3NwZWVkID0gMDtcblx0XHQgIH1cblx0XHQgIGVsc2UgaWYgKG9iai5tX3NwZWVkIDwgMClcblx0XHQgIHtcblx0XHRcdCAgb2JqLm1fc3BlZWQgKz0gMC4wMTtcblx0XHRcdCAgaWYgKG9iai5tX3NwZWVkID4gMClcblx0XHRcdFx0ICBvYmoubV9zcGVlZCA9IDA7XG5cdFx0ICB9XG5cdCAgfVxuXG5cdCAgcmV0dXJuIG1hcE92ZXI7XG4gIH1cblxuXG4gIGhpdFRlc3RPYmplY3Qob2JqOiBHYW1lT2JqZWN0KSB7XG5cdCAgY29uc3QgW3hQYXJ0LCB5UGFydF0gPSB0aGlzLnBvaW50VG9TZWdtZW50KG9iai5tX3Bvcy54LCBvYmoubV9wb3MueSk7XG5cblx0ICBpZiAoeFBhcnQgPj0gdGhpcy5tX3NwbGl0V2lkdGggfHwgeVBhcnQgPj0gdGhpcy5tX3NwbGl0SGVpZ2h0IHx8IHhQYXJ0IDwgMCB8fCB5UGFydCA8IDApXG5cdFx0ICByZXR1cm47XG5cblx0ICBjb25zdCBpbmRleCA9IHhQYXJ0ICsgeVBhcnQgKiB0aGlzLm1fc3BsaXRXaWR0aDtcblxuXHQgIGZvciAoY29uc3QgYyBvZiB0aGlzLm1fc3BsaXRDb2xsaWRlW2luZGV4XSlcblx0ICB7XG5cdFx0ICBpZiAoYy5sYXllciAhPSBvYmoubV9sYXllcilcblx0XHRcdCAgY29udGludWU7XG5cblx0XHQgIGlmIChvYmouZ2FtZU1hcEhpdChjLnN4LCBjLnN5LCBjLmV4LCBjLmV5KSlcblx0XHRcdCAgYnJlYWs7XG5cdCAgfVxuICB9XG5cbiAgZ2V0Q29sbGlkZUxpbmVzKHg6IG51bWJlciwgeTogbnVtYmVyLCByYWQ6IG51bWJlcik6IHJlYWRvbmx5IHNNYXBDb2xsaWRlW10ge1xuXHQgIHJldHVybiB0aGlzLm1fbWFwQ29sbGlkZTtcbiAgfVxuXG4gIG1hcFhUb1NjcmVlbih4OiBudW1iZXIsIGxheWVyOiBudW1iZXIpIHtcbiAgICByZXR1cm4gKHggLSB0aGlzLm1feCkgKiAoMS4wICsgKGxheWVyICogTUFQX0xBWUVSX0lOQykpXG4gIH1cbiAgXG4gIG1hcFlUb1NjcmVlbih5OiBudW1iZXIsIGxheWVyOiBudW1iZXIpIHtcbiAgICByZXR1cm4gKHkgLSB0aGlzLm1feSkgKiAoMS4wICsgKGxheWVyICogTUFQX0xBWUVSX0lOQykpXG4gIH1cbiAgXG4gIHN0YXRpYyBsYXllclNjYWxlKHZhbDogbnVtYmVyLCBsYXllcjogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHZhbCAqICgxLjAgKyAobGF5ZXIgKiBNQVBfTEFZRVJfSU5DKSlcbiAgfVxuXG5cbiAgbV90YXJnZXRYOiBudW1iZXIgPSAwXG4gIG1fdGFyZ2V0WTogbnVtYmVyID0gMFxuICBtX3g6IG51bWJlciA9IDBcbiAgbV95OiBudW1iZXIgPSAwXG5cbiAgbV9waWN0dXJlcz86IFBpY3R1cmVzXG5cbiAgcHJpdmF0ZSBwb2ludFRvU2VnbWVudCh4OiBudW1iZXIsIHk6IG51bWJlcik6IFtudW1iZXIsIG51bWJlcl1cbiAge1xuXHQgIHJldHVybiBbKHggLSB0aGlzLm1fbWlueCkgLyB0aGlzLm1fc2VnU2l6ZVgsICh5IC0gdGhpcy5tX21pbnkpIC8gdGhpcy5tX3NlZ1NpemVZXVxuICB9XG5cbiAgcHJpdmF0ZSBtX3RpbGV0eXBlcz86IFBpY3R1cmVzXG4gIHByaXZhdGUgbV9vYmplY3R0eXBlcz86IFBpY3R1cmVzXG5cbiAgcHJpdmF0ZSBtX3BMYXllckRyYXdSb3QgPSBbXSBhcyBHYW1lT2JqZWN0W107XG5cbiAgcHJpdmF0ZSBtX21vdmVQb3MgPSBbMCwwXTtcblxuICBwcml2YXRlIHNhdmUoKSB7IHRocm93KFwiTm90IGltcGxlbWVudGVkXCIpIH1cbiAgLy9UQkQgcHJpdmF0ZSB2b2lkIHNuYXBSZWdpb24oc01hcFBhcnQgKmZyb20sIGJvb2wgYlZlcnQpO1xuXG4gIHByaXZhdGUgbV9tYXBQYXJ0cyA9IFtdIGFzIHNNYXBQYXJ0W10gICAvLyBvd25lclxuICBwcml2YXRlIG1fbWFwQ29sbGlkZSA9IFtdIGFzIHNNYXBDb2xsaWRlW10gIC8vIG93bmVyXG4gIHByaXZhdGUgbV9zcGxpdFBhcnRzID0gW10gYXMgQXJyYXk8c01hcFBhcnRbXT4gLy8gcG9pbnQgdG8gbm9uLW93bmVyXG4gIHByaXZhdGUgbV9zcGxpdENvbGxpZGUgPSBbXSBhcyBBcnJheTxzTWFwQ29sbGlkZVtdPjsgLy8gcG9pbnQgdG8gbm9uLW93bmVyXG5cbiAgcHJpdmF0ZSBtX2VkaXRPYmplY3RzID0gW10gYXMgc01hcFBhcnRbXVxuICBwcml2YXRlIG1fZWRpdFRpbGVPcmRlciA9IFtdIGFzIG51bWJlcltdO1xuXG4gIHByaXZhdGUgbV9tYXBUZXN0ZXIgPSBuZXcgTWFwVGVzdGVyKCk7XG5cbiAgLy8gbWFwIGV4dGVudHNcbiAgcHJpdmF0ZSBtX21pbng6IG51bWJlciA9IC05OTk5OTk5XG4gIHByaXZhdGUgbV9taW55OiBudW1iZXIgPSAtOTk5OTk5OVxuICBwcml2YXRlIG1fc3BsaXRXaWR0aDogbnVtYmVyID0gMFxuICBwcml2YXRlIG1fc3BsaXRIZWlnaHQ6IG51bWJlciA9IDBcbiAgcHJpdmF0ZSByZWFkb25seSBtX3NlZ1NpemVYID0gNjQwKjRcbiAgcHJpdmF0ZSByZWFkb25seSBtX3NlZ1NpemVZID0gNDgwKjRcbn07XG4iXX0=