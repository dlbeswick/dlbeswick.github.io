var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { Pic } from "./pic.js";
import { g_App } from "./app.js";
export var EFonts;
(function (EFonts) {
    EFonts[EFonts["FONT_SYSTEM"] = 0] = "FONT_SYSTEM";
    EFonts[EFonts["NUM_FONTS"] = 1] = "NUM_FONTS";
})(EFonts || (EFonts = {}));
export class Fonts {
    constructor() {
        this.m_fonts = new Array(EFonts.NUM_FONTS);
        this.m_widths = new Array(EFonts.NUM_FONTS);
        this.m_heights = new Array(EFonts.NUM_FONTS);
        this.wobble1 = 0;
        this.wobble2 = 0;
    }
    getWidth(font) { return this.m_widths[font]; }
    getHeight(font) { return this.m_heights[font]; }
    init() {
        return __awaiter(this, void 0, void 0, function* () {
            this.m_fonts[EFonts.FONT_SYSTEM] = yield Pic.load("media/font.png");
            this.m_widths[EFonts.FONT_SYSTEM] = 24;
            this.m_heights[EFonts.FONT_SYSTEM] = 24;
        });
    }
    // write
    write(str, x, y, font = EFonts.FONT_SYSTEM) {
        const cols = Math.floor(this.m_fonts[font].width / this.m_widths[font]);
        for (let i = 0; i < str.length; i++) {
            const ch = str.charCodeAt(i) - ' '.charCodeAt(0);
            const ix = (1 + this.m_widths[font] * (ch % cols) + (ch % cols));
            const iy = (1 + this.m_heights[font] * Math.floor(ch / cols) + Math.floor(ch / cols));
            g_App.ctxCanvas.drawImage(this.m_fonts[font].img, ix, iy, this.m_widths[font], this.m_heights[font], x, y, this.m_widths[font], this.m_heights[font]);
            x += this.m_widths[font];
        }
    }
    wobbly(str, x, y, font) {
        const cols = Math.floor(this.m_fonts[font].width / this.m_widths[font]);
        for (let i = 0; i < str.length; i++) {
            const ch = str.charCodeAt(i) - ' '.charCodeAt(0);
            const ix = (1 + this.m_widths[font] * (ch % cols) + (ch % cols));
            const iy = (1 + this.m_heights[font] * Math.floor(ch / cols) + Math.floor(ch / cols));
            g_App.ctxCanvas.drawImage(this.m_fonts[font].img, ix, iy, this.m_widths[font], this.m_heights[font], x - g_App.Sin(this.wobble1) * 2 + g_App.Sin(this.wobble1) * 8, y - g_App.Cos(this.wobble2) * 2 + g_App.Cos(this.wobble2) * 8, this.m_widths[font] + g_App.Sin(this.wobble1) * 2 + g_App.Sin(this.wobble1) * 8, this.m_heights[font] + g_App.Cos(this.wobble2) * 2 + g_App.Cos(this.wobble2) * 8);
            x += this.m_widths[font];
            this.wobble1 += g_App.frand() * 10;
            this.wobble2 += g_App.frand() * 10;
            if (this.wobble1 >= g_App.SINNUM)
                this.wobble1 = 0;
            if (this.wobble2 >= g_App.SINNUM)
                this.wobble2 = 0;
        }
    }
    writeF(val, x, y, font) {
        this.write(val.toString(), x, y, font);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9udC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3RzL2ZvbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUM5QixPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBRWhDLE1BQU0sQ0FBTixJQUFZLE1BR1g7QUFIRCxXQUFZLE1BQU07SUFDakIsaURBQWUsQ0FBQTtJQUNmLDZDQUFTLENBQUE7QUFDVixDQUFDLEVBSFcsTUFBTSxLQUFOLE1BQU0sUUFHakI7QUFFRCxNQUFNLE9BQU8sS0FBSztJQUFsQjtRQUNTLFlBQU8sR0FBRyxJQUFJLEtBQUssQ0FBTSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDMUMsYUFBUSxHQUFHLElBQUksS0FBSyxDQUFTLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUM5QyxjQUFTLEdBQUcsSUFBSSxLQUFLLENBQVMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBbUM5QyxZQUFPLEdBQUcsQ0FBQyxDQUFBO1FBQ1osWUFBTyxHQUFHLENBQUMsQ0FBQTtJQXFDcEIsQ0FBQztJQXZFQSxRQUFRLENBQUMsSUFBWSxJQUFJLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDckQsU0FBUyxDQUFDLElBQVksSUFBSSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBRWhELElBQUk7O1lBQ1QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUE7WUFDbkUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxTQUFTLENBQUMs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QUFDLE9BQU8sSUFBSSxLQUFNLENBQUMsTUFBTTtnQkFDaEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUE7U0FDakI7SUFDRixDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQVcsRUFBRSxDQUFTLEVBQUUsQ0FBUyxFQUFFLElBQVk7UUFDckQsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUN2QyxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQaWMgfSBmcm9tIFwiLi9waWMuanNcIlxuaW1wb3J0IHsgZ19BcHAgfSBmcm9tIFwiLi9hcHAuanNcIlxuXG5leHBvcnQgZW51bSBFRm9udHNcdHtcblx0Rk9OVF9TWVNURU0gPSAwLFxuXHROVU1fRk9OVFNcbn1cblxuZXhwb3J0IGNsYXNzIEZvbnRzIHtcblx0cHJpdmF0ZSBtX2ZvbnRzID0gbmV3IEFycmF5PFBpYz4oRUZvbnRzLk5VTV9GT05UUylcblx0cHJpdmF0ZSBtX3dpZHRocyA9IG5ldyBBcnJheTxudW1iZXI+KEVGb250cy5OVU1fRk9OVFMpXG5cdHByaXZhdGUgbV9oZWlnaHRzID0gbmV3IEFycmF5PG51bWJlcj4oRUZvbnRzLk5VTV9GT05UUylcblxuXHRnZXRXaWR0aChmb250OiBFRm9udHMpIHsgcmV0dXJuIHRoaXMubV93aWR0aHNbZm9udF0gfVxuXHRnZXRIZWlnaHQoZm9udDogRUZvbnRzKSB7IHJldHVybiB0aGlzLm1faGVpZ2h0c1tmb250XSB9XG5cbiAgYXN5bmMgaW5pdCgpIHtcblx0ICB0aGlzLm1fZm9udHNbRUZvbnRzLkZPTlRfU1lTVEVNXSA9IGF3YWl0IFBpYy5sb2FkKFwibWVkaWEvZm9udC5wbmdcIilcblx0ICB0aGlzLm1fd2lkdGhzW0VGb250cy5GT05UX1NZU1RFTV0gPSAyNDtcblx0ICB0aGlzLm1faGVpZ2h0c1tFRm9udHMuRk9OVF9TWVNURU1dID0gMjQ7XG4gIH1cblxuICAvLyB3cml0ZVxuICB3cml0ZShzdHI6IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIsIGZvbnQ6IEVGb250cyA9IEVGb250cy5GT05UX1NZU1RFTSkge1xuXHQgIGNvbnN0IGNvbHMgPSBNYXRoLmZsb29yKHRoaXMubV9mb250c1tmb250XS53aWR0aCAvIHRoaXMubV93aWR0aHNbZm9udF0pXG5cblx0ICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuXHRcdCAgY29uc3QgY2ggPSBzdHIuY2hhckNvZGVBdChpKSAtICcgJy5jaGFyQ29kZUF0KDApO1xuXHRcdCAgY29uc3QgaXggPSAoMSArIHRoaXMubV93aWR0aHNbZm9udF0gKiAoY2ggJSBjb2xzKSArIChjaCAlIGNvbHMpKVxuXHRcdCAgY29uc3QgaXkgPSAoMSArIHRoaXMubV9oZWlnaHRzW2ZvbnRdICogTWF0aC5mbG9vcihjaCAvIGNvbHMpICsgTWF0aC5mbG9vcihjaCAvIGNvbHMpKVxuXG4gICAgICBnX0FwcCEuY3R4Q2FudmFzLmRyYXdJbWFnZShcbiAgICAgICAgdGhpcy5tX2ZvbnRzW2ZvbnRdLmltZyxcbiAgICAgICAgaXgsXG4gICAgICAgIGl5LFxuICAgICAgICB0aGlzLm1fd2lkdGhzW2ZvbnRdLFxuICAgICAgICB0aGlzLm1faGVpZ2h0c1tmb250XSxcbiAgICAgICAgeCxcbiAgICAgICAgeSxcbiAgICAgICAgdGhpcy5tX3dpZHRoc1tmb250XSxcbiAgICAgICAgdGhpcy5tX2hlaWdodHNbZm9udF0pXG5cblx0XHQgIHggKz0gdGhpcy5tX3dpZHRoc1tmb250XVxuXHQgIH1cbiAgfVxuXG4gIHByaXZhdGUgd29iYmxlMSA9IDBcblx0cHJpdmF0ZSB3b2JibGUyID0gMFxuICBcbiAgd29iYmx5KHN0cjogc3RyaW5nLCB4OiBudW1iZXIsIHk6IG51bWJlciwgZm9udDogRUZvbnRzKSB7XG5cdCAgY29uc3QgY29scyA9IE1hdGguZmxvb3IodGhpcy5tX2ZvbnRzW2ZvbnRdLndpZHRoIC8gdGhpcy5tX3dpZHRoc1tmb250XSk7XG5cblx0ICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuXHRcdCAgY29uc3QgY2ggPSBzdHIuY2hhckNvZGVBdChpKSAtICcgJy5jaGFyQ29kZUF0KDApXG5cdFx0ICBjb25zdCBpeCA9ICgxICsgdGhpcy5tX3dpZHRoc1tmb250XSAqIChjaCAlIGNvbHMpICsgKGNoICUgY29scykpXG5cdFx0ICBjb25zdCBpeSA9ICgxICsgdGhpcy5tX2hlaWdodHNbZm9udF0gKiBNYXRoLmZsb29yKGNoIC8gY29scykgKyBNYXRoLmZsb29yKGNoIC8gY29scykpXG5cbiAgICAgIGdfQXBwIS5jdHhDYW52YXMuZHJhd0ltYWdlKFxuICAgICAgICB0aGlzLm1fZm9udHNbZm9udF0uaW1nLFxuICAgICAgICBpeCxcbiAgICAgICAgaXksXG4gICAgICAgIHRoaXMubV93aWR0aHNbZm9udF0sXG4gICAgICAgIHRoaXMubV9oZWlnaHRzW2ZvbnRdLFxuICAgICAgICB4IC0gZ19BcHAhLlNpbih0aGlzLndvYmJsZTEpICogMiArIGdfQXBwIS5TaW4odGhpcy53b2JibGUxKSAqIDgsXG4gICAgICAgIHkgLSBnX0FwcCEuQ29zKHRoaXMud29iYmxlMikgKiAyICsgZ19BcHAhLkNvcyh0aGlzLndvYmJsZTIpICogOCxcbiAgICAgICAgdGhpcy5tX3dpZHRoc1tmb250XSArIGdfQXBwIS5TaW4odGhpcy53b2JibGUxKSAqIDIgKyBnX0FwcCEuU2luKHRoaXMud29iYmxlMSkgKiA4LFxuICAgICAgICB0aGlzLm1faGVpZ2h0c1tmb250XSArIGdfQXBwIS5Db3ModGhpcy53b2JibGUyKSAqIDIgKyBnX0FwcCEuQ29zKHRoaXMud29iYmxlMikgKiA4XG4gICAgICApXG5cblx0XHQgIHggKz0gdGhpcy5tX3dpZHRoc1tmb250XVxuXG5cdFx0ICB0aGlzLndvYmJsZTEgKz0gZ19BcHAhLmZyYW5kKCkgKiAxMFxuXHRcdCAgdGhpcy53b2JibGUyICs9IGdfQXBwIS5mcmFuZCgpICogMTBcbiAgICAgIFxuXHRcdCAgaWYgKHRoaXMud29iYmxlMSA+PSBnX0FwcCEuU0lOTlVNKVxuXHRcdFx0ICB0aGlzLndvYmJsZTEgPSAwXG5cdFx0ICBpZiAodGhpcy53b2JibGUyID49IGdfQXBwIS5TSU5OVU0pXG5cdFx0XHQgIHRoaXMud29iYmxlMiA9IDBcblx0ICB9XG4gIH1cblxuICB3cml0ZUYodmFsOiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyLCBmb250OiBFRm9udHMpIHtcblx0ICB0aGlzLndyaXRlKHZhbC50b1N0cmluZygpLCB4LCB5LCBmb250KVxuICB9XG59XG4iXX0=