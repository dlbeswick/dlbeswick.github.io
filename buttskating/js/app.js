var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { assert } from "./assert.js";
import { Fonts } from "./font.js";
import { GameObject } from "./gameobject.js";
import { Input } from "./input.js";
import { CMap } from "./map.js";
import { Menu } from "./menu.js";
import { Point2 } from "./point2.js";
import { Sounder } from "./sounder.js";
import { Transition } from "./transition.js";
export var STATE;
(function (STATE) {
    STATE[STATE["MENU"] = 0] = "MENU";
    STATE[STATE["GAME"] = 1] = "GAME";
    STATE[STATE["MAPEDIT"] = 2] = "MAPEDIT";
    STATE[STATE["QUIT"] = 3] = "QUIT";
})(STATE || (STATE = {}));
export var g_App;
class App {
    constructor(canvas) {
        this.SINNUM = 360 * 5;
        this.fonts = new Fonts();
        this.m_pSound = new Sounder();
        this.m_debugTime = 0;
        this.m_updateTime = 0;
        this.m_sin = [];
        this.m_cos = [];
        this.m_pObjects = [];
        this.m_bRunning = false;
        this.m_bTerm = false;
        this.m_input = new Input();
        this.m_loadLev = "";
        this.m_menu = new Menu();
        this.m_transition = new Transition();
        this.totalFrames = 0;
        this.timeStart = new Date().getTime();
        this.stat = new Date().getTime();
        this.m_frameTime = 0;
        this.m_totalTime = 0;
        this.m_state = STATE.MENU;
        this.canvas = canvas;
        assert(this.canvas);
        this.ctxCanvas = this.canvas.getContext("2d", { alpha: false });
        assert(this.ctxCanvas);
        this.ctxCanvas.imageSmoothingEnabled = false;
        this.m_map = new CMap(this.ctxCanvas);
    }
    getSound() { return this.m_pSound; }
    destroy() {
        this.m_bTerm = true;
        this.m_pObjects.length = 0;
    }
    init() {
        return __awaiter(this, void 0, void 0, function* () {
            // Init sound
            this.m_pSound = new Sounder();
            this.getSound().Init();
            if (this.getSound().error)
                throw (this.getSound().error);
            this.getSound().LoadWAV("media/menu01.wav", "MENU01");
            this.getSound().LoadWAV("media/menu02.wav", "MENU02");
            this.getSound().LoadWAV("media/misc01.wav", "MISC01");
            this.getSound().LoadWAV("media/misc02.wav", "MISC02");
            this.getSound().LoadWAV("media/misc03.wav", "MISC03");
            const promises = [];
            promises.push(GameObject.initStatic());
            // Init map
            if (this.m_state == STATE.MAPEDIT)
                promises.push(this.m_map.init(true));
            else
                promises.push(this.m_map.init(false));
            // Init fonts
            promises.push(this.fonts.init().then(() => this.fonts.write("Now loading", 0, 0)));
            // Init Sin/Cos Tables
            let f = 0;
            for (let i = 0; i < this.SINNUM; i++) {
                this.m_sin[i] = Math.sin(f);
                this.m_cos[i] = Math.cos(f);
                f += (Math.PI * 2) / this.SINNUM;
            }
            // Init transitions
            promises.push(this.m_transition.init());
            // Init Menu
            this.m_menu.addItem("Main Menu", "Start");
            this.m_menu.addItem("Main Menu", "Options");
            this.m_menu.addItem("Main Menu", "Quit");
            this.m_menu.addItem("Options", "Skill : Easy");
            this.m_menu.addItem("Options", "FX is on");
            this.m_menu.addItem("Options", "Music is on");
            this.m_menu.addItem("Options", "Back");
            this.m_menu.setMenu("Main Menu");
            // Start thread etc
            this.m_bTerm = false;
            for (const p of promises)
                yield p;
            // Load map if specified
            if (this.m_loadLev != "") {
                yield this.m_map.loadBinary(this.m_loadLev, false);
            }
            this.canvas.onkeydown = (e) => {
                this.m_input.onKeyDown(e.code);
                this.m_input.key(e.key);
                e.preventDefault();
            };
            this.canvas.onkeyup = (e) => {
                this.m_input.onKeyUp(e.code);
                e.preventDefault();
            };
            return false;
        });
    }
    Sin(entry) { return this.m_sin[Math.floor(entry)]; }
    Cos(entry) { return this.m_cos[Math.floor(entry)]; }
    update(timestamp) {
        if (this.m_bTerm) {
            return;
        }
        this.m_bRunning = true;
        // get ready for the next frame
        this.clearSurf();
        // update phase
        switch (this.m_state) {
            case STATE.MENU:
                this.m_menu.update();
                break;
            case STATE.GAME:
                if (this.m_input.bufferKey() == "KeyD")
                    this.m_map.debug = !this.m_map.debug;
                // update map
                this.m_map.update();
                // update objects
                for (let i = 0; i < this.m_pObjects.length; ++i) {
                    const obj = this.m_pObjects[i];
                    if (obj && !obj.gameUpdate()) {
                        obj.destroy();
                        delete this.m_pObjects[i];
                    }
                }
                if (this.m_input.key("Escape") && !this.m_transition.isBusy()) {
                    this.m_transition.goTransition(this.m_transition.SPIRALBLOCKS, STATE.MENU, Promise.resolve());
                }
                break;
        }
        // draw phase
        switch (this.m_state) {
            case STATE.MENU:
                this.m_menu.draw();
                break;
            case STATE.GAME:
                // prepare objects for drawing
                for (const obj of this.m_pObjects) {
                    if (obj)
                        this.m_map.queueLayerDraw(obj);
                }
                this.m_map.draw(this.ctxCanvas, 0, 999999);
                break;
        }
        this.m_transition.update();
        // print fps
        if (this.m_updateTime != 0)
            this.fonts.write("fps " + Math.floor(1000.0 / (new Date().getTime() - this.m_updateTime)), 420, 480 - 32);
        this.m_updateTime = new Date().getTime();
        this.m_totalTime += this.m_frameTime;
        this.totalFrames++;
        if (this.m_state == STATE.QUIT || this.m_input.key("F4")) {
            this.m_bTerm = true;
        }
        window.requestAnimationFrame(this.update.bind(this));
    }
    // Lock back surface
    lockBackSurf() {
        return this.canvas;
    }
    // Draw from a framerect
    drawFrame(x, y, f, scale = 1) {
        this.ctxCanvas.drawImage(f.img, f.x0, f.y0, f.width, f.height, x, y, f.width * scale, f.height * scale);
    }
    // Is point in box?
    pointBox(x, y, bx, by, bx1, by1) {
        if (x < bx || x > bx1 || y < by || y > by1)
            return false;
        return true;
    }
    // Box-box collision
    boxBox(x, y, x1, y1, xx, yy, xx1, yy1) {
        if ((x >= xx && y >= yy && x <= xx1 && y <= yy1) ||
            (x >= xx && y >= yy && x1 <= xx1 && y1 <= yy1) ||
            (x1 >= xx && y1 >= yy && x <= xx1 && y <= yy1) ||
            (x1 >= xx && y1 >= yy && x1 <= xx1 && y1 <= yy1))
            return true;
        else
            return false;
    }
    // Draw a coloured rectangle
    drawRect(x, y, x1, y1, color) {
        this.ctxCanvas.fillStyle = color;
        this.ctxCanvas.fillRect(x, y, x1 - x, y1 - y);
    }
    // Draw a line
    drawLine(x, y, x2, y2, color) {
        this.ctxCanvas.strokeStyle = color;
        this.ctxCanvas.beginPath();
        this.ctxCanvas.moveTo(x, y);
        this.ctxCanvas.lineTo(x2, y2);
        this.ctxCanvas.stroke();
    }
    // Return true if a circle of pos cx,cy and radius rad collides with the given line.
    // Gives the X and Y of the hit in hitX, hitY if non-null
    circleLine(cx, cy, rad, sx, sy, ex, ey) {
        const length = Math.sqrt((ex - sx) * (ex - sx) + (ey - sy) * (ey - sy));
        const vector = [
            (ex - sx) / length,
            (ey - sy) / length
        ];
        const dist = (vector[0] * (cx - sx)) + (vector[1] * (cy - sy));
        const newX = sx + dist * vector[0];
        const newY = sy + dist * vector[1];
        let [x1, x2, y1, y2] = [0, 0, 0, 0];
        if (sx < ex)
            x1 = sx;
        else
            x1 = ex;
        if (sy < ey)
            y1 = sy;
        else
            y1 = ey;
        if (sx > ex)
            x2 = sx;
        else
            x2 = ex;
        if (sy > ey)
            y2 = sy;
        else
            y2 = ey;
        if (this.pointBox(newX, newY, x1, y1, x2, y2)) {
            const newLength = Math.sqrt((newX - cx) * (newX - cx) + (newY - cy) * (newY - cy));
            if (newLength <= rad) {
                return new Point2(newX, newY);
            }
        }
        return undefined;
    }
    frand(begin = 0, range = 1) {
        // returns random value between 0 and 1
        // i got the magic numbers from csound so they should be ok but 
        // I haven't checked them myself
        //   -- Jeskola
        // Thanks Jeskola
        this.stat = ((this.stat * 1103515245 + 12345) & 0x7fffffff) >>> 0;
        return begin + this.stat * (range / 0x7fffffff);
    }
    irand(begin = 0, range = 1) {
        return Math.floor(this.frand(begin, range));
    }
    clearSurf() {
        this.ctxCanvas.resetTransform();
        this.ctxCanvas.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
    lineLine(Ax, Ay, Bx, By, Cx, Cy, Dx, Dy) {
        let r = ((Ay - Cy) * (Dx - Cx) - (Ax - Cx) * (Dy - Cy));
        // lines are coincident
        if (r == 0)
            return true;
        let d = (Bx - Ax) * (Dy - Cy) - (By - Ay) * (Dx - Cx);
        // lines are parallel
        if (d == 0)
            return false;
        // reciprocal for speed
        d = 1.0 / d;
        r *= d;
        if (r < 0 || r > 1)
            return false;
        const s = ((Ay - Cy) * (Bx - Ax) - (Ax - Cx) * (By - Ay)) * d;
        if (s < 0 || s > 1)
            return false;
        return true;
    }
    add(obj) {
        this.m_pObjects.push(obj);
    }
    clearObjects() {
        for (const obj of this.m_pObjects)
            obj === null || obj === void 0 ? void 0 : obj.destroy();
        this.m_pObjects.length = 0;
    }
    stateChange(state) {
        this.m_state = state;
        this.m_input.bufferClear();
    }
}
document.addEventListener('DOMContentLoaded', () => __awaiter(void 0, void 0, void 0, function* () {
    g_App = new App(document.getElementById("playfield"));
    yield g_App.init();
    g_App.update(0);
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdHMvYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxhQUFhLENBQUE7QUFDcEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUNqQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUE7QUFDNUMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUVsQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQy9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDaEMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUNwQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQ3RDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUU1QyxNQUFNLENBQU4sSUFBWSxLQUtYO0FBTEQsV0FBWSxLQUFLO0lBQ2hCLGlDQUFJLENBQUE7SUFDSixpQ0FBSSxDQUFBO0lBQ0osdUNBQU8sQ0FBQTtJQUNQLGlDQUFJLENBQUE7QUFDTCxDQUFDLEVBTFcsS0FBSyxLQUFMLEtBQUssUUFLaEI7QUFFRCxNQUFNLENBQUMsSUFBSSxLQUFvQixDQUFBO0FBRS9CLE1BQU0sR0FBRztJQWlDUCxZQUFZLE1BQXlCO1FBaEN0QyxXQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQTtRQUlmLFVBQUssR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFBO1FBQ1gsYUFBUSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUE7UUFDekIsZ0JBQVcsR0FBRyxDQUFDLENBQUE7UUFHZixpQkFBWSxHQUFHLENBQUMsQ0FBQTtRQUdoQixVQUFLLEdBQUcsRUFBYyxDQUFBO1FBQ3RCLFVBQUssR0FBRyxFQUFjLENBQUE7UUFF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LENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsR0FBUyxFQUFFO0lBQ3ZELEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBc0IsQ0FBQyxDQUFBO0lBQzFFLE1BQU0sS0FBSyxDQUFDLElBQUksRUFBRSxDQUFBO0lBQ2xCLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDakIsQ0FBQyxDQUFBLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzc2VydCB9IGZyb20gXCIuL2Fzc2VydC5qc1wiXG5pbXBvcnQgeyBGb250cyB9IGZyb20gXCIuL2ZvbnQuanNcIlxuaW1wb3J0IHsgR2FtZU9iamVjdCB9IGZyb20gXCIuL2dhbWVvYmplY3QuanNcIlxuaW1wb3J0IHsgSW5wdXQgfSBmcm9tIFwiLi9pbnB1dC5qc1wiXG5pbXBvcnQgeyBGcmFtZUluZm8gfSBmcm9tIFwiLi9waWN0dXJlcy5qc1wiXG5pbXBvcnQgeyBDTWFwIH0gZnJvbSBcIi4vbWFwLmpzXCJcbmltcG9ydCB7IE1lbnUgfSBmcm9tIFwiLi9tZW51LmpzXCJcbmltcG9ydCB7IFBvaW50MiB9IGZyb20gXCIuL3BvaW50Mi5qc1wiXG5pbXBvcnQgeyBTb3VuZGVyIH0gZnJvbSBcIi4vc291bmRlci5qc1wiXG5pbXBvcnQgeyBUcmFuc2l0aW9uIH0gZnJvbSBcIi4vdHJhbnNpdGlvbi5qc1wiXG5cbmV4cG9ydCBlbnVtIFNUQVRFIHtcblx0TUVOVSxcblx0R0FNRSxcblx0TUFQRURJVCxcblx0UVVJVFxufVxuXG5leHBvcnQgdmFyIGdfQXBwOiBBcHB8dW5kZWZpbmVkXG5cbmNsYXNzIEFwcCB7XG5cdFNJTk5VTSA9IDM2MCAqIDVcblxuICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50XG4gIGN0eENhbnZhczogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEXG4gIGZvbnRzID0gbmV3IEZvbnRzKClcbiAgcHJpdmF0ZSBtX3BTb3VuZCA9IG5ldyBTb3VuZGVyKClcblx0cHJpdmF0ZSBtX2RlYnVnVGltZSA9IDBcblxuXHRwcml2YXRlIG1fZnJhbWVUaW1lOiBudW1iZXJcblx0cHJpdmF0ZVx0bV91cGRhdGVUaW1lID0gMFxuXHRwcml2YXRlIG1fdG90YWxUaW1lOiBudW1iZXJcblxuXHRwcml2YXRlIG1fc2luID0gW10gYXMgbnVtYmVyW11cblx0cHJpdmF0ZSBtX2NvcyA9IFtdIGFzIG51bWJlcltdXG5cblx0bV9wT2JqZWN0cyA9IFtdIGFzIChHYW1lT2JqZWN0fHVuZGVmaW5lZClbXVxuXHRtX2JSdW5uaW5nID0gZmFsc2Vcblx0bV9iVGVybSA9IGZhbHNlXG5cbiAgbV9tYXA6IENNYXBcblx0bV9pbnB1dCA9IG5ldyBJbnB1dCgpXG5cblx0bV9zdGF0ZTogU1RBVEVcblxuXHRtX2xvYWRMZXY6IHN0cmluZyA9IFwiXCJcblxuXHRtX21lbnUgPSBuZXcgTWVudSgpXG5cblx0bV90cmFuc2l0aW9uID0gbmV3IFRyYW5zaXRpb24oKVxuXG5cdGdldFNvdW5kKCk6IFNvdW5kZXIgeyByZXR1cm4gdGhpcy5tX3BTb3VuZCB9XG5cbiAgY29uc3RydWN0b3IoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkge1xuICAgIHRoaXMubV9mcmFtZVRpbWUgPSAwXG4gICAgdGhpcy5tX3RvdGFsVGltZSA9IDBcbiAgICB0aGlzLm1fc3RhdGUgPSBTVEFURS5NRU5VXG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXNcbiAgICBhc3NlcnQodGhpcy5jYW52YXMpXG4gICAgdGhpcy5jdHhDYW52YXMgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIiwge2FscGhhOiBmYWxzZX0pIVxuICAgIGFzc2VydCh0aGlzLmN0eENhbnZhcylcbiAgICB0aGlzLmN0eENhbnZhcy5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZVxuXHQgIHRoaXMubV9tYXAgPSBuZXcgQ01hcCh0aGlzLmN0eENhbnZhcylcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5tX2JUZXJtID0gdHJ1ZTtcblxuICAgIHRoaXMubV9wT2JqZWN0cy5sZW5ndGggPSAwXG4gIH1cblxuICBhc3luYyBpbml0KCkge1xuICAgIC8vIEluaXQgc291bmRcbiAgICB0aGlzLm1fcFNvdW5kID0gbmV3IFNvdW5kZXIoKVxuICAgIHRoaXMuZ2V0U291bmQoKS5Jbml0KClcbiAgICBpZiAodGhpcy5nZXRTb3VuZCgpLmVycm9yKVxuICAgICAgdGhyb3codGhpcy5nZXRTb3VuZCgpLmVycm9yKVxuXG4gICAgdGhpcy5nZXRTb3VuZCgpLkxvYWRXQVYoXCJtZWRpYS9tZW51MDEud2F2XCIsIFwiTUVOVTAxXCIpXG4gICAgdGhpcy5nZXRTb3VuZCgpLkxvYWRXQVYoXCJtZWRpYS9tZW51MDIud2F2XCIsIFwiTUVOVTAyXCIpXG4gICAgdGhpcy5nZXRTb3VuZCgpLkxvYWRXQVYoXCJtZWRpYS9taXNjMDEud2F2XCIsIFwiTUlTQzAxXCIpXG4gICAgdGhpcy5nZXRTb3VuZCgpLkxvYWRXQVYoXCJtZWRpYS9taXNjMDIud2F2XCIsIFwiTUlTQzAyXCIpXG4gICAgdGhpcy5nZXRTb3VuZCgpLkxvYWRXQVYoXCJtZWRpYS9taXNjMDMud2F2XCIsIFwiTUlTQzAzXCIpXG5cbiAgICBjb25zdCBwcm9taXNlcyA9IFtdIGFzIFByb21pc2U8YW55PltdXG4gICAgcHJvbWlzZXMucHVzaChHYW1lT2JqZWN0LmluaXRTdGF0aWMoKSlcbiAgICBcbiAgICAvLyBJbml0IG1hcFxuXG4gICAgaWYgKHRoaXMubV9zdGF0ZSA9PSBTVEFURS5NQVBFRElUKVxuICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLm1fbWFwLmluaXQodHJ1ZSkpXG4gICAgZWxzZVxuICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLm1fbWFwLmluaXQoZmFsc2UpKVxuXG4gICAgLy8gSW5pdCBmb250c1xuICAgIFxuICAgIHByb21pc2VzLnB1c2godGhpcy5mb250cy5pbml0KCkudGhlbigoKSA9PiB0aGlzLmZvbnRzLndyaXRlKFwiTm93IGxvYWRpbmdcIiwgMCwgMCkpKVxuXG4gICAgLy8gSW5pdCBTaW4vQ29zIFRhYmxlc1xuXG4gICAgbGV0IGYgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5TSU5OVU07IGkrKykge1xuICAgICAgdGhpcy5tX3NpbltpXSA9IE1hdGguc2luKGYpXG4gICAgICB0aGlzLm1fY29zW2ldID0gTWF0aC5jb3MoZilcbiAgICAgIGYgKz0gKE1hdGguUEkgKiAyKSAvIHRoaXMuU0lOTlVNXG4gICAgfVxuXG4gICAgLy8gSW5pdCB0cmFuc2l0aW9uc1xuXG4gICAgcHJvbWlzZXMucHVzaCh0aGlzLm1fdHJhbnNpdGlvbi5pbml0KCkpXG5cbiAgICAvLyBJbml0IE1lbnVcblxuICAgIHRoaXMubV9tZW51LmFkZEl0ZW0oXCJNYWluIE1lbnVcIiwgXCJTdGFydFwiKVxuICAgIHRoaXMubV9tZW51LmFkZEl0ZW0oXCJNYWluIE1lbnVcIiwgXCJPcHRpb25zXCIpXG4gICAgdGhpcy5tX21lbnUuYWRkSXRlbShcIk1haW4gTWVudVwiLCBcIlF1aXRcIilcbiAgXG4gICAgdGhpcy5tX21lbnUuYWRkSXRlbShcIk9wdGlvbnNcIiwgXCJTa2lsbCA6IEVhc3lcIilcbiAgICB0aGlzLm1fbWVudS5hZGRJdGVtKFwiT3B0aW9uc1wiLCBcIkZYIGlzIG9uXCIpXG4gICAgdGhpcy5tX21lbnUuYWRkSXRlbShcIk9wdGlvbnNcIiwgXCJNdXNpYyBpcyBvblwiKVxuICAgIHRoaXMubV9tZW51LmFkZEl0ZW0oXCJPcHRpb25zXCIsIFwiQmFja1wiKVxuICBcbiAgICB0aGlzLm1fbWVudS5zZXRNZW51KFwiTWFpbiBNZW51XCIpXG5cbiAgICAvLyBTdGFydCB0aHJlYWQgZXRjXG5cbiAgICB0aGlzLm1fYlRlcm0gPSBmYWxzZVxuXG4gICAgZm9yIChjb25zdCBwIG9mIHByb21pc2VzKVxuICAgICAgYXdhaXQgcFxuICAgIFxuICAgIC8vIExvYWQgbWFwIGlmIHNwZWNpZmllZFxuICAgIGlmICh0aGlzLm1fbG9hZExldiAhPSBcIlwiKVxuICAgIHtcbiAgICAgIGF3YWl0IHRoaXMubV9tYXAubG9hZEJpbmFyeSh0aGlzLm1fbG9hZExldiwgZmFsc2UpXG4gICAgfVxuXG4gICAgdGhpcy5jYW52YXMub25rZXlkb3duID0gKGUpID0+IHtcbiAgICAgIHRoaXMubV9pbnB1dC5vbktleURvd24oZS5jb2RlKVxuICAgICAgdGhpcy5tX2lucHV0LmtleShlLmtleSlcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIH1cbiAgICB0aGlzLmNhbnZhcy5vbmtleXVwID0gKGUpID0+IHtcbiAgICAgIHRoaXMubV9pbnB1dC5vbktleVVwKGUuY29kZSk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuXHRTaW4oZW50cnk6IG51bWJlcilcdFx0eyByZXR1cm4gdGhpcy5tX3NpbltNYXRoLmZsb29yKGVudHJ5KV0gfVxuXHRDb3MoZW50cnk6IG51bWJlcilcdFx0eyByZXR1cm4gdGhpcy5tX2Nvc1tNYXRoLmZsb29yKGVudHJ5KV0gfVxuXG4gIHByaXZhdGUgdG90YWxGcmFtZXMgPSAwO1xuICBwcml2YXRlIHRpbWVTdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG4gIFxuICB1cGRhdGUodGltZXN0YW1wOiBET01IaWdoUmVzVGltZVN0YW1wKSB7XG4gICAgaWYgKHRoaXMubV9iVGVybSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy5tX2JSdW5uaW5nID0gdHJ1ZVxuXG4gICAgLy8gZ2V0IHJlYWR5IGZvciB0aGUgbmV4dCBmcmFtZVxuICAgIHRoaXMuY2xlYXJTdXJmKClcbiAgXG4gICAgLy8gdXBkYXRlIHBoYXNlXG4gICAgc3dpdGNoICh0aGlzLm1fc3RhdGUpIHtcbiAgICAgIGNhc2UgU1RBVEUuTUVOVTpcbiAgICAgICAgdGhpcy5tX21lbnUudXBkYXRlKClcbiAgICAgICAgYnJlYWtcblxuICAgICAgY2FzZSBTVEFURS5HQU1FOlxuICAgICAgICBpZiAodGhpcy5tX2lucHV0LmJ1ZmZlcktleSgpID09IFwiS2V5RFwiKVxuICAgICAgICAgIHRoaXMubV9tYXAuZGVidWcgPSAhdGhpcy5tX21hcC5kZWJ1Z1xuICAgICAgICBcbiAgICAgICAgLy8gdXBkYXRlIG1hcFxuICAgICAgICB0aGlzLm1fbWFwLnVwZGF0ZSgpXG5cbiAgICAgICAgLy8gdXBkYXRlIG9iamVjdHNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm1fcE9iamVjdHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBjb25zdCBvYmogPSB0aGlzLm1fcE9iamVjdHNbaV1cbiAgICAgICAgICBpZiAob2JqICYmICFvYmouZ2FtZVVwZGF0ZSgpKSB7XG4gICAgICAgICAgICBvYmouZGVzdHJveSgpXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5tX3BPYmplY3RzW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm1faW5wdXQua2V5KFwiRXNjYXBlXCIpICYmICF0aGlzLm1fdHJhbnNpdGlvbi5pc0J1c3koKSkge1xuICAgICAgICAgIHRoaXMubV90cmFuc2l0aW9uLmdvVHJhbnNpdGlvbih0aGlzLm1fdHJhbnNpdGlvbi5TUElSQUxCTE9DS1MsIFNUQVRFLk1FTlUsIFByb21pc2UucmVzb2x2ZSgpKVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIGRyYXcgcGhhc2VcbiAgICBzd2l0Y2ggKHRoaXMubV9zdGF0ZSkge1xuICAgICAgY2FzZSBTVEFURS5NRU5VOlxuICAgICAgICB0aGlzLm1fbWVudS5kcmF3KClcbiAgICAgICAgYnJlYWtcblxuICAgICAgY2FzZSBTVEFURS5HQU1FOlxuICAgICAgICAvLyBwcmVwYXJlIG9iamVjdHMgZm9yIGRyYXdpbmdcbiAgICAgICAgZm9yIChjb25zdCBvYmogb2YgdGhpcy5tX3BPYmplY3RzKSB7XG4gICAgICAgICAgaWYgKG9iailcbiAgICAgICAgICAgIHRoaXMubV9tYXAucXVldWVMYXllckRyYXcob2JqKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tX21hcC5kcmF3KHRoaXMuY3R4Q2FudmFzLCAwLCA5OTk5OTkpXG4gICAgICAgIFxuICAgICAgICBicmVha1xuICAgIH1cblxuICAgIHRoaXMubV90cmFuc2l0aW9uLnVwZGF0ZSgpXG5cbiAgICAvLyBwcmludCBmcHNcbiAgICBpZiAodGhpcy5tX3VwZGF0ZVRpbWUgIT0gMClcbiAgICAgIHRoaXMuZm9udHMud3JpdGUoXCJmcHMgXCIgKyBNYXRoLmZsb29yKDEwMDAuMCAvIChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMubV91cGRhdGVUaW1lKSksIDQyMCwgNDgwIC0gMzIpXG5cbiAgICB0aGlzLm1fdXBkYXRlVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG5cbiAgICB0aGlzLm1fdG90YWxUaW1lICs9IHRoaXMubV9mcmFtZVRpbWU7XG5cbiAgICB0aGlzLnRvdGFsRnJhbWVzKys7XG5cbiAgICBpZiAodGhpcy5tX3N0YXRlID09IFNUQVRFLlFVSVQgfHwgdGhpcy5tX2lucHV0LmtleShcIkY0XCIpKSB7XG4gICAgICB0aGlzLm1fYlRlcm0gPSB0cnVlXG4gICAgfVxuXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpKVxuICB9XG5cblxuICAvLyBMb2NrIGJhY2sgc3VyZmFjZVxuICBsb2NrQmFja1N1cmYoKTogSFRNTENhbnZhc0VsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmNhbnZhc1xuICB9XG5cbiAgLy8gRHJhdyBmcm9tIGEgZnJhbWVyZWN0XG4gIGRyYXdGcmFtZSh4OiBudW1iZXIsIHk6IG51bWJlciwgZjogRnJhbWVJbmZvLCBzY2FsZSA9IDEpIHtcbiAgICB0aGlzLmN0eENhbnZhcy5kcmF3SW1hZ2UoZi5pbWcsIGYueDAsIGYueTAsIGYud2lkdGgsIGYuaGVpZ2h0LCB4LCB5LCBmLndpZHRoICogc2NhbGUsIGYuaGVpZ2h0ICogc2NhbGUpXG4gIH1cblxuICAvLyBJcyBwb2ludCBpbiBib3g/XG4gIHBvaW50Qm94KHg6IG51bWJlciwgeTogbnVtYmVyLCBieDogbnVtYmVyLCBieTogbnVtYmVyLCBieDE6IG51bWJlciwgYnkxOiBudW1iZXIpIHtcbiAgICBpZiAoeCA8IGJ4IHx8IHggPiBieDEgfHwgeSA8IGJ5IHx8IHkgPiBieTEpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICBcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cblxuICAvLyBCb3gtYm94IGNvbGxpc2lvblxuICBib3hCb3goeDogbnVtYmVyLCB5OiBudW1iZXIsIHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHh4OiBudW1iZXIsIHl5OiBudW1iZXIsIHh4MTogbnVtYmVyLCB5eTE6IG51bWJlcikge1xuICAgIGlmICgoeD49eHggJiYgeT49eXkgJiYgeDw9eHgxICYmIHk8PXl5MSkgfHxcbiAgICAgICh4Pj14eCAmJiB5Pj15eSAmJiB4MTw9eHgxICYmIHkxPD15eTEpIHx8XG4gICAgICAoeDE+PXh4ICYmIHkxPj15eSAmJiB4PD14eDEgJiYgeTw9eXkxKSB8fFxuICAgICAgKHgxPj14eCAmJiB5MT49eXkgJiYgeDE8PXh4MSAmJiB5MTw9eXkxKSlcbiAgICAgIHJldHVybiB0cnVlXG4gICAgZWxzZVxuICAgICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvLyBEcmF3IGEgY29sb3VyZWQgcmVjdGFuZ2xlXG4gIGRyYXdSZWN0KHg6IG51bWJlciwgeTogbnVtYmVyLCB4MTogbnVtYmVyLCB5MTogbnVtYmVyLCBjb2xvcjogc3RyaW5nKSB7XG4gICAgdGhpcy5jdHhDYW52YXMuZmlsbFN0eWxlID0gY29sb3JcbiAgICB0aGlzLmN0eENhbnZhcy5maWxsUmVjdCh4LCB5LCB4MSAtIHgsIHkxIC0geSlcbiAgfVxuXG4gIC8vIERyYXcgYSBsaW5lXG4gIGRyYXdMaW5lKHg6IG51bWJlciwgeTogbnVtYmVyLCB4MjogbnVtYmVyLCB5MjogbnVtYmVyLCBjb2xvcjogc3RyaW5nKSB7XG4gICAgdGhpcy5jdHhDYW52YXMuc3Ryb2tlU3R5bGUgPSBjb2xvclxuICAgIHRoaXMuY3R4Q2FudmFzLmJlZ2luUGF0aCgpXG4gICAgdGhpcy5jdHhDYW52YXMubW92ZVRvKHgsIHkpXG4gICAgdGhpcy5jdHhDYW52YXMubGluZVRvKHgyLCB5MilcbiAgICB0aGlzLmN0eENhbnZhcy5zdHJva2UoKVxuICB9XG5cbiAgLy8gUmV0dXJuIHRydWUgaWYgYSBjaXJjbGUgb2YgcG9zIGN4LGN5IGFuZCByYWRpdXMgcmFkIGNvbGxpZGVzIHdpdGggdGhlIGdpdmVuIGxpbmUuXG4gIC8vIEdpdmVzIHRoZSBYIGFuZCBZIG9mIHRoZSBoaXQgaW4gaGl0WCwgaGl0WSBpZiBub24tbnVsbFxuICBjaXJjbGVMaW5lKGN4OiBudW1iZXIsIGN5OiBudW1iZXIsIHJhZDogbnVtYmVyLCBzeDogbnVtYmVyLCBzeTogbnVtYmVyLCBleDogbnVtYmVyLCBleTogbnVtYmVyKTogUG9pbnQyfHVuZGVmaW5lZCB7XG4gICAgY29uc3QgbGVuZ3RoID0gTWF0aC5zcXJ0KChleCAtIHN4KSAqIChleCAtIHN4KSArIChleSAtIHN5KSAqIChleSAtIHN5KSk7XG5cbiAgICBjb25zdCB2ZWN0b3IgPSBbXG4gICAgICAoZXggLSBzeCkgLyBsZW5ndGgsXG4gICAgICAoZXkgLSBzeSkgLyBsZW5ndGhcbiAgICBdXG5cbiAgICBjb25zdCBkaXN0ID0gKHZlY3RvclswXSAqIChjeCAtIHN4KSkgKyAodmVjdG9yWzFdICogKGN5IC0gc3kpKTtcbiAgICBjb25zdCBuZXdYID0gc3ggKyBkaXN0ICogdmVjdG9yWzBdO1xuICAgIGNvbnN0IG5ld1kgPSBzeSArIGRpc3QgKiB2ZWN0b3JbMV07XG5cbiAgICBsZXQgW3gxLHgyLHkxLHkyXSA9IFswLDAsMCwwXVxuXG4gICAgaWYgKHN4IDwgZXgpXG4gICAgICB4MSA9IHN4O1xuICAgIGVsc2VcbiAgICAgIHgxID0gZXg7XG4gICAgaWYgKHN5IDwgZXkpXG4gICAgICB5MSA9IHN5O1xuICAgIGVsc2VcbiAgICAgIHkxID0gZXk7XG4gICAgaWYgKHN4ID4gZXgpXG4gICAgICB4MiA9IHN4O1xuICAgIGVsc2VcbiAgICAgIHgyID0gZXg7XG4gICAgaWYgKHN5ID4gZXkpXG4gICAgICB5MiA9IHN5O1xuICAgIGVsc2VcbiAgICAgIHkyID0gZXk7XG5cbiAgICBpZiAodGhpcy5wb2ludEJveChuZXdYLCBuZXdZLCB4MSwgeTEsIHgyLCB5MikpIHtcbiAgICAgIGNvbnN0IG5ld0xlbmd0aCA9IE1hdGguc3FydCgobmV3WCAtIGN4KSAqIChuZXdYIC0gY3gpICsgKG5ld1kgLSBjeSkgKiAobmV3WSAtIGN5KSlcblxuICAgICAgaWYgKG5ld0xlbmd0aCA8PSByYWQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQb2ludDIobmV3WCwgbmV3WSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cblxuICBwcml2YXRlIHN0YXQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICBcbiAgZnJhbmQoYmVnaW46IG51bWJlciA9IDAsIHJhbmdlOiBudW1iZXIgPSAxKTogbnVtYmVyIHtcbiAgICAvLyByZXR1cm5zIHJhbmRvbSB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDFcbiAgICAvLyBpIGdvdCB0aGUgbWFnaWMgbnVtYmVycyBmcm9tIGNzb3VuZCBzbyB0aGV5IHNob3VsZCBiZSBvayBidXQgXG4gICAgLy8gSSBoYXZlbid0IGNoZWNrZWQgdGhlbSBteXNlbGZcbiAgICAvLyAgIC0tIEplc2tvbGFcbiAgICBcbiAgICAvLyBUaGFua3MgSmVza29sYVxuICAgIHRoaXMuc3RhdCA9ICgodGhpcy5zdGF0ICogMTEwMzUxNTI0NSArIDEyMzQ1KSAmIDB4N2ZmZmZmZmYpID4+PiAwXG4gICAgcmV0dXJuIGJlZ2luICsgdGhpcy5zdGF0ICogKHJhbmdlIC8gMHg3ZmZmZmZmZilcbiAgfVxuXG4gIGlyYW5kKGJlZ2luOiBudW1iZXIgPSAwLCByYW5nZTogbnVtYmVyID0gMSk6IG51bWJlciB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5mcmFuZChiZWdpbiwgcmFuZ2UpKVxuICB9XG5cbiAgY2xlYXJTdXJmKCkge1xuICAgIHRoaXMuY3R4Q2FudmFzLnJlc2V0VHJhbnNmb3JtKClcbiAgICB0aGlzLmN0eENhbnZhcy5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodClcbiAgfVxuXG4gIGxpbmVMaW5lKEF4OiBudW1iZXIsIEF5OiBudW1iZXIsIEJ4OiBudW1iZXIsIEJ5OiBudW1iZXIsIEN4OiBudW1iZXIsIEN5OiBudW1iZXIsIER4OiBudW1iZXIsIER5OiBudW1iZXIpIHtcbiAgICBsZXQgciA9ICgoQXktQ3kpICogKER4LUN4KSAtIChBeC1DeCkgKiAoRHktQ3kpKVxuXG4gICAgLy8gbGluZXMgYXJlIGNvaW5jaWRlbnRcbiAgICBpZiAociA9PSAwKVxuICAgICAgcmV0dXJuIHRydWVcblxuICAgIGxldCBkID0gKEJ4LUF4KSAqIChEeS1DeSkgLSAoQnktQXkpICogKER4LUN4KVxuICAgIFxuICAgIC8vIGxpbmVzIGFyZSBwYXJhbGxlbFxuICAgIGlmIChkID09IDApXG4gICAgICByZXR1cm4gZmFsc2VcblxuICAgIC8vIHJlY2lwcm9jYWwgZm9yIHNwZWVkXG4gICAgZCA9IDEuMCAvIGRcbiAgICByICo9IGRcblxuICAgIGlmIChyIDwgMCB8fCByID4gMSlcbiAgICAgIHJldHVybiBmYWxzZVxuICBcbiAgICBjb25zdCBzID0gKChBeS1DeSkgKiAoQngtQXgpIC0gKEF4LUN4KSAqIChCeS1BeSkpICogZFxuXG4gICAgaWYgKHMgPCAwIHx8IHMgPiAxKVxuICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cblxuICBhZGQob2JqOiBHYW1lT2JqZWN0KSB7XG4gICAgdGhpcy5tX3BPYmplY3RzLnB1c2gob2JqKVxuICB9XG5cbiAgY2xlYXJPYmplY3RzKCkge1xuICAgIGZvciAoY29uc3Qgb2JqIG9mIHRoaXMubV9wT2JqZWN0cylcbiAgICAgIG9iaj8uZGVzdHJveSgpXG4gICAgdGhpcy5tX3BPYmplY3RzLmxlbmd0aCA9IDBcbiAgfVxuXG4gIHN0YXRlQ2hhbmdlKHN0YXRlOiBTVEFURSkge1xuICAgIHRoaXMubV9zdGF0ZSA9IHN0YXRlXG4gICAgdGhpcy5tX2lucHV0LmJ1ZmZlckNsZWFyKClcbiAgfVxufVxuXG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhc3luYyAoKSA9PiB7XG4gIGdfQXBwID0gbmV3IEFwcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXlmaWVsZFwiKSBhcyBIVE1MQ2FudmFzRWxlbWVudClcbiAgYXdhaXQgZ19BcHAuaW5pdCgpXG4gIGdfQXBwLnVwZGF0ZSgwKVxufSlcbiJdfQ==